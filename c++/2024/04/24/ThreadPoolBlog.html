<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c"> --><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ä¸€ä¸ªç°ä»£ C++ å®ç°çš„é«˜æ•ˆçº¿ç¨‹æ±  | Razirpâ€™s Blog</title>
<meta name="generator" content="Jekyll v4.3.3">
<meta property="og:title" content="ä¸€ä¸ªç°ä»£ C++ å®ç°çš„é«˜æ•ˆçº¿ç¨‹æ± ">
<meta name="author" content="Razirp">
<meta property="og:locale" content="en_US">
<meta name="description" content="A thread pool implemented in modern C++. ä»£ç å·²å¼€æºåœ¨ GitHubã€‚">
<meta property="og:description" content="A thread pool implemented in modern C++. ä»£ç å·²å¼€æºåœ¨ GitHubã€‚">
<link rel="canonical" href="https//razirp.github.io/jekyll-theme-yat/c++/2024/04/24/ThreadPoolBlog.html">
<meta property="og:url" content="https//razirp.github.io/jekyll-theme-yat/c++/2024/04/24/ThreadPoolBlog.html">
<meta property="og:site_name" content="Razirpâ€™s Blog">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-04-24T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="ä¸€ä¸ªç°ä»£ C++ å®ç°çš„é«˜æ•ˆçº¿ç¨‹æ± ">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Razirp"},"dateModified":"2024-04-24T00:00:00+00:00","datePublished":"2024-04-24T00:00:00+00:00","description":"A thread pool implemented in modern C++. ä»£ç å·²å¼€æºåœ¨ GitHubã€‚","headline":"ä¸€ä¸ªç°ä»£ C++ å®ç°çš„é«˜æ•ˆçº¿ç¨‹æ± ","mainEntityOfPage":{"@type":"WebPage","@id":"https//razirp.github.io/jekyll-theme-yat/c++/2024/04/24/ThreadPoolBlog.html"},"url":"https//razirp.github.io/jekyll-theme-yat/c++/2024/04/24/ThreadPoolBlog.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="icon" href="">
  <link rel="canonical" href="https//razirp.github.io">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/jekyll-theme-yat/assets/css/main.css">
  <script src="/jekyll-theme-yat/assets/js/main.js"></script><link type="application/atom+xml" rel="alternate" href="https//razirp.github.io/jekyll-theme-yat/feed.xml" title="Razirp's Blog">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/go.min.js" async></script>



















<script>
// Init highlight js
document.addEventListener('DOMContentLoaded', function(event) {
  var els = document.querySelectorAll('pre code')

  function addLangData(block) {
    var outer = block.parentElement.parentElement.parentElement;
    var lang = block.getAttribute('data-lang');
    for (var i = 0; i < outer.classList.length; i++) {
      var cls = outer.classList[i];
      if (cls.startsWith('language-')) {
        lang = cls;
        break;
      }
    }
    if (!lang) {
      cls = block.getAttribute('class');
      lang = cls ? cls.replace('hljs ', '') : '';
    }
    if (lang.startsWith('language-')) {
      lang = lang.substr(9);
    }
    block.setAttribute('class', 'hljs ' + lang);
    block.parentNode.setAttribute('data-lang', lang);
  }

  function addBadge(block) {
    var enabled = ('true' || 'true').toLowerCase();
    if (enabled == 'true') {
      var pre = block.parentElement;
      pre.classList.add('badge');
    }
  }

  function handle(block) {
    addLangData(block);
    addBadge(block)
    hljs.highlightBlock(block);
  }

  for (var i = 0; i < els.length; i++) {
    var el = els[i];
    handle(el);
  }
});
</script>

<style>
  /* code language badge */
  pre.badge::before {
    content: attr(data-lang);
    color: #fff;
    background-color: #ff4e00;
    padding: 0 .5em;
    border-radius: 0 2px;
    text-transform: uppercase;
    text-align: center;
    min-width: 32px;
    display: inline-block;
    position: absolute;
    right: 0;
  }

  /* fix wrong badge display for firefox browser */
  code > table pre::before {
    display: none;
  }
</style>
<script src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/umd/photoswipe-lightbox.umd.min.js" async></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/umd/photoswipe.umd.min.js" async></script>
<link href="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/photoswipe.min.css" rel="stylesheet">
<style>
  .pswp .pswp__container .pswp__img {
    background-color: white;
  }
</style>

<script>
  function initPhotoSwipe() {
    let customOptions = {};

    try {
      const data = ``.replaceAll("=>", ":");
      customOptions = JSON.parse(data);
    } catch (e) {
      console.info("Invalid custom photo previewer options! " + e.message);
    }

    // Define object and gallery options
    const options = Object.assign(
      {
        gallery: "section.main",
        children: "a.photo-swipe",
        photo_scale: 2,
        // dynamic import is not supported in UMD version
        pswpModule: PhotoSwipe,
      },
      customOptions
    );

    const galleryEl = document.querySelector(options.gallery);
    if (!galleryEl) {
      return;
    }

    const imgEls = [];
    const els = galleryEl.querySelectorAll("img:not(.emoji)");
    els.forEach((el) => {
      if (el.src.trim() == "") {
        return;
      }
      if (!imgEls.includes(el)) {
        imgEls.push(el);
      }
    });

    if (imgEls.length === 0) {
      return;
    }

    imgEls.forEach((imgEl) => {
      imgEl.outerHTML = `
      <a class="photo-swipe"
        href="${imgEl.src}"
        data-pswp-width="${
          Math.max(imgEl.naturalWidth, imgEl.width) * options.photo_scale
        }"
        data-pswp-height="${
          Math.max(imgEl.naturalHeight, imgEl.height) * options.photo_scale
        }"
        data-pswp-caption="${imgEl.getAttribute("caption") || imgEl.alt}"
        target="_blank">
        ${imgEl.outerHTML}
      </a>`;
    });

    // Initialize PhotoSwipe 5
    var lightbox = new PhotoSwipeLightbox(options);

    lightbox.init();
  }

  window.addEventListener("load", initPhotoSwipe);
</script>
</head>
<body>





































































































































<header class="site-header site-header-transparent" role="banner">

  <div class="wrapper">
    <div class="site-header-inner">
<span class="site-brand"><a class="site-brand-inner" rel="author" href="/jekyll-theme-yat/">
  <img class="site-favicon" title="Razirp's Blog" src="" onerror="this.style.display='none'">
  Razirp's Blog
</a>
</span><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger">
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewbox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
              </svg>
            </span>
          </label>

          <div class="trigger">
<a class="page-link" href="/jekyll-theme-yat/">é¦–é¡µ</a><a class="page-link" href="/jekyll-theme-yat/archives.html">åšå®¢</a><a class="page-link" href="/jekyll-theme-yat/categories.html">åˆ†ç±»</a><a class="page-link" href="/jekyll-theme-yat/tags.html">æ ‡ç­¾</a><a class="page-link" href="/jekyll-theme-yat/about.html">å…³äº</a><!--









<div class="page-link" style="display: inline;">



<div id="google_translate_element" style="display: none;">
</div>

<div class="ct-language">
  <ul class="list-unstyled ct-language-dropdown">
    
      <li>
        <a href="#" class="lang-select" data-lang="en">
          
          <img src="https://cdn.countryflags.com/thumbs/united-states-of-america/flag-400.png" title="English">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="fr">
          
          <img src="https://cdn.countryflags.com/thumbs/france/flag-400.png" title="French">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="zh-CN">
          
          <img src="https://cdn.countryflags.com/thumbs/china/flag-400.png" title="Chinese(Simple)">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ja">
          
          <img src="https://cdn.countryflags.com/thumbs/japan/flag-400.png" title="Japanese">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ko">
          
          <img src="https://cdn.countryflags.com/thumbs/south-korea/flag-400.png" title="Korean">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ru">
          
          <img src="https://cdn.countryflags.com/thumbs/russia/flag-400.png" title="Russian">
          
        </a>
      </li>
    
  </ul>
</div>

<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'en',
    autoDisplay: false,
    layout: google.translate.TranslateElement.InlineLayout.VERTICAL
  }, 'google_translate_element');

  // Links to cross-origin destinations are unsafe
  var gll = document.getElementsByClassName('goog-logo-link')[0];
  if (gll) {
    gll.setAttribute('rel', 'noopener');
  }

  function restoreLang() {
    var iframe = document.getElementsByClassName('goog-te-banner-frame')[0];
    if (!iframe) return;

    var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
    var restore_el = innerDoc.getElementsByTagName("button");

    for (var i = 0; i < restore_el.length; i++) {
      if (restore_el[i].id.indexOf("restore") >= 0) {
        restore_el[i].click();
        var close_el = innerDoc.getElementsByClassName("goog-close-link");
        close_el[0].click();
        return;
      }
    }
  }

  function triggerHtmlEvent(element, eventName) {
    var event;
    if (document.createEvent) {
      event = document.createEvent('HTMLEvents');
      event.initEvent(eventName, true, true);
      element.dispatchEvent(event);
    } else {
      event = document.createEventObject();
      event.eventType = eventName;
      element.fireEvent('on' + event.eventType, event);
    }
  }

  var googleCombo = document.querySelector("select.goog-te-combo");
  var langSelect = document.querySelector('.ct-language');
  langSelect.addEventListener('click', function(event) {
    if (!event.target) {
      return;
    }

    var selected = document.querySelector('.ct-language .ct-language-selected');
    if (selected) {
      selected.classList.remove('ct-language-selected');
    }

    var target = event.target;
    while (target && target !== langSelect ) {
      if (target.matches('.lang-select')) {
        break;
      }
      target = target.parentElement;
    }

    if (target && target.matches('.lang-select')) {
      var lang = target.getAttribute('data-lang');
      if (googleCombo.value == lang) {
        restoreLang();
      } else {
        target.parentElement.classList.add('ct-language-selected');
        googleCombo.value = lang;
        triggerHtmlEvent(googleCombo, 'change');
      }
    }

    event.preventDefault();
  });
}
</script>

<script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" async></script>
</div>-->
          </div>
        </nav>
</div>
  </div>
</header>

<script>
  function initHeader() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;documentElement.setAttribute("data-header-transparent", "");var scrollStatus = "";

      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }

      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }

    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });

    storeScrollData();
  }
  document.addEventListener('DOMContentLoaded', initHeader);
</script>


























































































































































<style>
    html .page-banner {
      background: #000;
    }
  </style>
<style>html .page-banner {
      height:  36.8vh;
      min-height: 38vh;
    }
    html[data-scroll-status="top"] .page-banner {
      height: 100vh;
    }
  </style>
<style>
    html .page-banner .page-banner-img > *:first-child {
      opacity: 0.618;
    }

    html[data-theme="dark"] .page-banner .page-banner-img > *:first-child {
      opacity: 0.443724;
    }
  </style>
<style>
    html .page-banner .page-banner-inner > *:first-child > *:nth-child(1) {
      font-size: 4.25em; font-weight: bold; text-decoration: underline
    }
  </style>
<style>
    html .page-banner .page-banner-inner > *:first-child > *:nth-child(2) {
      color: gold
    }
  </style>
<section class="page-banner">
    <div class="page-banner-img">
<div style="background-image: url(/jekyll-theme-yat/assets/images/backgrounds/thread_pool.jpeg)"></div>
        <img class="img-placeholder" src="/jekyll-theme-yat/assets/images/backgrounds/thread_pool.jpeg">
</div>
    <div class="wrapper">
      <div class="page-banner-inner">
<header class="post-header">
  <h1 class="post-title p-name" itemprop="name headline">ä¸€ä¸ªç°ä»£ C++ å®ç°çš„é«˜æ•ˆçº¿ç¨‹æ± </h1>
  <h2 class="post-subtitle">å·¥ä½œåŸç†ä¸å®ç°ç»†èŠ‚</h2>

  <div class="post-meta">
    <time class="dt-published" datetime="2024-04-24T00:00:00+00:00" itemprop="datePublished"><i class="fa fa-calendar"></i> 2024 Apr 24
    </time><span class="post-author left-vsplit"><i class="fa fa-pencil"></i> Razirp</span>
    
































    <span class="post-reading-time left-vsplit"><i class="fa fa-clock-o"></i> About 23 mins</span>
  </div>
<div class="post-tags">
<a class="post-tag" href="/jekyll-theme-yat/tags.html#%E7%BA%BF%E7%A8%8B%E6%B1%A0">#çº¿ç¨‹æ± </a><a class="post-tag" href="/jekyll-theme-yat/tags.html#%E9%A1%B9%E7%9B%AE">#é¡¹ç›®</a><a class="post-tag" href="/jekyll-theme-yat/tags.html#C++">#C++</a>
</div></header>
</div>
    </div>
  </section><script>
  function hashLocate(hashValue) {
    hashValue = hashValue.replace(/^.*#h-/, '');
    hashValue = decodeURIComponent(hashValue);
    var element = document.getElementById(hashValue);

    if (!element) {
      return;
    }

    var header = document.querySelector('header.site-header');
    var headerRect = header.getBoundingClientRect();
    var headerTop = Math.floor(headerRect.top);
    var headerHeight = Math.floor(headerRect.height);
    var scrollPos = getScrollPos();
    var offsetY = element.offsetTop - (headerTop + headerHeight + 20);

    if (offsetY == scrollPos.y) {
      return;
    }

    if (headerTop == 0  && offsetY > scrollPos.y) {
      offsetY += headerHeight + 2;
    } else if (headerTop < 0  && offsetY < scrollPos.y) {
      offsetY -= headerHeight - 2;
    }

    smoothScrollTo(offsetY);
  }

  // The first event occurred
  window.addEventListener('load', function(event) {
    if (window.location.hash) {
      hashLocate(window.location.hash);
    }
  });

  // The first event occurred
  window.addEventListener('click', function(event) {
    if (event.target.tagName.toLowerCase() == 'a') {
      hashLocate(event.target.getAttribute('href'));
    }
  });
</script>
<div class="theme-toggle">
  <input type="checkbox" id="theme-switch">
  <label for="theme-switch">
    <div class="toggle"></div>
    <div class="names">
      <p class="light">Light</p>
      <p class="dark">Dark</p>
    </div>
  </label>
</div>




<script>
  (function() {
    var sw = document.getElementById('theme-switch');
    var html = document.getElementsByTagName('html')[0];
    var nightModeOption = ('off' || 'auto').toLowerCase();
    var storage = nightModeOption === 'manual'
        ? localStorage
        : sessionStorage;
    var themeData = loadThemeData();

    function saveThemeData(data) {
      storage.setItem('theme', JSON.stringify(data));
    }

    function loadThemeData() {
      var data = storage.getItem('theme');
      try {
        data = JSON.parse(data ? data : '');
      } catch(e) {
        data = { nightShift: undefined, autoToggleAt: 0 };
        saveThemeData(data);
      }
      return data;
    }

    function handleThemeToggle(nightShift) {
      themeData.nightShift = nightShift;
      saveThemeData(themeData);
      html.dataset.theme = nightShift ? 'dark' : 'light';
      setTimeout(function() {
        sw.checked = nightShift ? true : false;
      }, 50);
    }

    function autoThemeToggle() {
      // Next time point of theme toggle
      var now = new Date();
      var toggleAt = new Date();
      var hours = now.getHours();
      var nightShift = hours >= 19 || hours <=7;

      if (nightShift) {
        if (hours > 7) {
          toggleAt.setDate(toggleAt.getDate() + 1);
        }
        toggleAt.setHours(7);
      } else {
        toggleAt.setHours(19);
      }

      toggleAt.setMinutes(0);
      toggleAt.setSeconds(0);
      toggleAt.setMilliseconds(0)

      var delay = toggleAt.getTime() - now.getTime();

      // auto toggle theme mode
      setTimeout(function() {
        handleThemeToggle(!nightShift);
      }, delay);

      return {
        nightShift: nightShift,
        toggleAt: toggleAt.getTime()
      };
    }

    // Listen the theme toggle event
    sw.addEventListener('change', function(event) {
      handleThemeToggle(event.target.checked);
    });

    if (nightModeOption == 'auto') {
      var data = autoThemeToggle();

      // Toggle theme by local setting
      if (data.toggleAt > themeData.autoToggleAt) {
        themeData.autoToggleAt = data.toggleAt;
        handleThemeToggle(data.nightShift);
      } else {
        handleThemeToggle(themeData.nightShift);
      }
    } else if (nightModeOption == 'manual') {
      handleThemeToggle(themeData.nightShift);
    } else {
      var nightShift = themeData.nightShift;
      if (nightShift === undefined) {
        nightShift = nightModeOption === 'on';
      }
      handleThemeToggle(nightShift);
    }
  })();
</script>
<div id="click-to-top" class="click-to-top">
  <i class="fa fa-arrow-up"></i>
</div>
<script>
  (function () {
    const clickToTop = document.getElementById('click-to-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 100) {
        clickToTop.classList.add('show')
      }else {
        clickToTop.classList.remove('show')
      }
    });
    clickToTop.addEventListener('click', () => {
      window.smoothScrollTo(0);
    });
  })();
</script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script>
      <script type="text/javascript">
        (function(){
          // Initial mermaid
          mermaid.init({startOnLoad:true}, "pre code.language-mermaid", function(){
            // Change <pre> and <code> block style
            var codeBlock = document.querySelector('code.language-mermaid');
            var preBlock = codeBlock.parentNode;

            codeBlock.style.backgroundColor = 'initial';
            preBlock.style.border = 'none';
            preBlock.style.textAlign = 'center';
            preBlock.style.backgroundColor = 'initial';
          });
        })()
      </script><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="framework">
  <section class="main">

     <div class="post">
  <section>









<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="post-content e-content" itemprop="articleBody">

      <blockquote>
  <p>A thread pool implemented in modern C++.</p>

  <p>ä»£ç å·²å¼€æºåœ¨ <a href="https://github.com/Razirp/ThreadPool">GitHub</a>ã€‚</p>
</blockquote>

<h2 id="i-å¼•è¨€">I. å¼•è¨€</h2>

<p>åœ¨ç°ä»£è½¯ä»¶å¼€å‘ä¸­ï¼Œå¤šçº¿ç¨‹ç¼–ç¨‹å·²ç»æˆä¸ºæé«˜åº”ç”¨ç¨‹åºæ€§èƒ½ã€å®ç°å¹¶å‘ä»»åŠ¡å¤„ç†çš„é‡è¦æ‰‹æ®µã€‚ç„¶è€Œï¼Œç›´æ¥ç®¡ç†å¤šä¸ªçº¿ç¨‹å¾€å¾€ä¼´éšç€å¤æ‚æ€§å¢åŠ ã€èµ„æºæµªè´¹å’ŒåŒæ­¥é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œ<strong>çº¿ç¨‹æ± </strong>ä½œä¸ºä¸€ç§æœ‰æ•ˆçš„çº¿ç¨‹ç®¡ç†æœºåˆ¶åº”è¿è€Œç”Ÿã€‚</p>

<p><strong>çº¿ç¨‹æ± </strong>é¢„å…ˆåˆ›å»ºä¸€ç»„å·¥ä½œçº¿ç¨‹ï¼Œå°†å¾…æ‰§è¡Œä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ï¼Œç”±æ± å†…çº¿ç¨‹è´Ÿè´£ä»»åŠ¡çš„åˆ†é…ä¸æ‰§è¡Œï¼Œä»è€Œç®€åŒ–çº¿ç¨‹ç®¡ç†ã€å‡å°‘ç³»ç»Ÿé¢‘ç¹åˆ›å»ºä¸é”€æ¯çº¿ç¨‹çš„å¼€é”€ã€æé«˜èµ„æºåˆ©ç”¨ç‡ã€‚</p>

<p>å½“å‰ç°æœ‰çš„ C++ çº¿ç¨‹æ± å®ç°å¾€å¾€éš¾ä»¥åœ¨ç®€å•æ˜“ç”¨æ€§å’Œæ–‡æ¡£çš„ä¸°å¯Œæ€§ä¸Šå–å¾—å¹³è¡¡ï¼š</p>

<ul>
  <li>å…·æœ‰è‰¯å¥½æ–‡æ¡£è¯´æ˜çš„ C++ çº¿ç¨‹æ± é¡¹ç›®å¸¸å¸¸è§„æ¨¡åºå¤§ã€ä¾èµ–å¤æ‚ï¼Œéš¾ä»¥å¿«é€Ÿç†è§£æˆ–ä¸Šæ‰‹ä½¿ç”¨ï¼›</li>
  <li>å®ç°ç®€å•çš„ C++ é¡¹ç›®å¾€å¾€ç¼ºä¹è¶³å¤Ÿçš„æ–‡æ¡£è¯´æ˜ï¼Œå¼€å‘è€…éœ€è¦è‡ªè¡Œé˜…è¯»æºä»£ç æ¥ç†è§£å…¶å®ç°åŸç†ä¸ä½¿ç”¨æ–¹å¼ã€‚</li>
</ul>

<p>æ­¤å¤–å¯¹äºåƒä½œè€…ä¸€æ ·çš„ä»¥ä¸­æ–‡ä¸ºæ¯è¯­çš„å¼€å‘è€…ï¼ˆè¿™ä¸€ç¾¤ä½“å±å®äººæ•°ä¼—å¤šğŸ¥¸ï¼‰è€Œè¨€ï¼Œæˆ‘ä»¬å¸¸å¸¸æ„Ÿåˆ°ç¼ºä¹è¶³å¤Ÿçš„æ‹¥æœ‰ä¸­æ–‡æ–‡æ¡£çš„é¡¹ç›®å¯ä¾›ç ”ç©¶ï¼ˆç”šè‡³å¾ˆå¤šé¡¹ç›®å³ä½¿æ˜¯ç”±ä¸­å›½å¼€å‘è€…å¼€å‘çš„ï¼Œå®ƒä»¬çš„æ–‡æ¡£ä»ç„¶æ˜¯è‹±æ–‡ğŸ¥²ï¼‰ï¼Œå¾€å¾€éœ€è¦è¢«è¿«ä½¿ç”¨è‹±è¯­ç­‰éæ¯è¯­è¯­è¨€è¿›è¡Œæ–‡æ¡£çš„é˜…è¯»ï¼Œä¸èƒ½è¾¾åˆ°æœ€ä½³æ•ˆç‡ã€‚</p>

<p>é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œä½œè€…å¸Œæœ›èƒ½å¤Ÿå®ç°ä¸€ä¸ª<strong>ç®€å•æ˜“ç”¨</strong>å¹¶ä¸”å…·æœ‰ä¸°å¯Œ<strong>ä¸­/è‹±æ–‡æ–‡æ¡£</strong>è¯´æ˜çš„ C++ çº¿ç¨‹æ± åº“ï¼Œä»¥æœŸèƒ½å¤ŸåŠ©åŠ›äºå¼€å‘è€…ç¤¾åŒºçš„å­¦ä¹ ã€ç ”ç©¶ä¸ä½¿ç”¨ã€‚</p>

<blockquote>
  <p>ä»£ç å·²å¼€æºåœ¨ <a href="https://github.com/Razirp/ThreadPool">GitHub</a>ã€‚</p>
</blockquote>

<h3 id="çº¿ç¨‹æ± çš„ä¼˜åŠ¿">çº¿ç¨‹æ± çš„ä¼˜åŠ¿</h3>

<h4 id="èµ„æºç®¡ç†ä¸æ€§èƒ½ä¼˜åŒ–">èµ„æºç®¡ç†ä¸æ€§èƒ½ä¼˜åŒ–</h4>

<ul>
  <li>
<strong>é¿å…é¢‘ç¹åˆ›å»ºä¸é”€æ¯çº¿ç¨‹</strong>ï¼šçº¿ç¨‹æ± é¢„å…ˆåˆ›å»ºå¹¶ç»´æŠ¤ä¸€å®šæ•°é‡çš„å·¥ä½œçº¿ç¨‹ï¼Œé¿å…äº†é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹å¸¦æ¥çš„ç³»ç»Ÿå¼€é”€ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡çŸ­ç”Ÿå‘½å‘¨æœŸä»»åŠ¡æ—¶ï¼Œæ•ˆæœå°¤ä¸ºæ˜¾è‘—ã€‚</li>
  <li>
<strong>å‡è¡¡è´Ÿè½½ä¸ç¼“å­˜å±€éƒ¨æ€§</strong>ï¼šçº¿ç¨‹æ± å¯ä»¥æ ¹æ®ä»»åŠ¡è´Ÿè½½åŠ¨æ€è°ƒæ•´çº¿ç¨‹å·¥ä½œçŠ¶æ€ï¼Œé¿å…è¿‡åº¦ç«äº‰å’Œé—²ç½®ã€‚åŒæ—¶ï¼Œçº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡è¿‡ç¨‹ä¸­å¯ä»¥å……åˆ†åˆ©ç”¨CPUç¼“å­˜ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡ã€‚</li>
  <li>
<strong>æ§åˆ¶å¹¶å‘çº§åˆ«</strong>ï¼šé€šè¿‡é™åˆ¶çº¿ç¨‹æ± å¤§å°å’Œä»»åŠ¡é˜Ÿåˆ—å®¹é‡ï¼Œå¯ä»¥æœ‰æ•ˆæ§åˆ¶ç³»ç»Ÿçš„å¹¶å‘çº§åˆ«ï¼Œé˜²æ­¢å› è¿‡åº¦å¹¶å‘å¯¼è‡´çš„èµ„æºäº‰æŠ¢å’Œæ€§èƒ½ä¸‹é™ã€‚</li>
</ul>

<h4 id="ç®€åŒ–ç¼–ç¨‹æ¨¡å‹">ç®€åŒ–ç¼–ç¨‹æ¨¡å‹</h4>

<ul>
  <li>
<strong>ç»Ÿä¸€ä»»åŠ¡æäº¤æ¥å£</strong>ï¼šçº¿ç¨‹æ± æä¾›ç»Ÿä¸€çš„æ¥å£ä¾›å¼€å‘è€…æäº¤ä»»åŠ¡ï¼Œæ— éœ€å…³å¿ƒçº¿ç¨‹åˆ›å»ºã€åŒæ­¥ç­‰åº•å±‚ç»†èŠ‚ï¼Œé™ä½äº†å¤šçº¿ç¨‹ç¼–ç¨‹çš„å¤æ‚åº¦ã€‚</li>
  <li>
<strong>å¼‚å¸¸å¤„ç†ä¸ä»»åŠ¡å–æ¶ˆ</strong>ï¼šçº¿ç¨‹æ± é€šå¸¸æ”¯æŒå¼‚å¸¸å¤„ç†æœºåˆ¶å’Œä»»åŠ¡å–æ¶ˆåŠŸèƒ½ï¼Œä½¿å¾—åœ¨å‡ºç°å¼‚å¸¸æƒ…å†µæˆ–éœ€æ±‚å˜æ›´æ—¶ï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°ç®¡ç†å’Œè°ƒæ•´ä»»åŠ¡æ‰§è¡Œã€‚
    <ul>
      <li>ä½†æœ¬é¡¹ç›®ç›®å‰è¿˜æœªé’ˆå¯¹è¿™ä¸€æ–¹é¢è¿›è¡Œç‰¹åˆ«çš„å®ç°ğŸ¥²ã€‚</li>
    </ul>
  </li>
</ul>

<h2 id="ii-è®¾è®¡æ¦‚è§ˆ">II. è®¾è®¡æ¦‚è§ˆ</h2>

<div class="mermaid">
classDiagram
    class thread_pool {
        +thread_pool(std::size_t initial_thread_count, std::size_t max_task_count)
        +~thread_pool()
        +template &lt;typename F, typename... Args&gt; std::future&lt;decltype(f(args...))&gt; submit(F &amp;&amp;f, Args &amp;&amp;...args)
        +void pause()
        +void resume()
        +void shutdown()
        +void shutdown_now()
        +void terminate()
        +void wait()
        +void add_thread(std::size_t count_to_add)
        +void remove_thread(std::size_t count_to_remove)
        +void set_max_task_count(std::size_t count_to_set)
        +std::size_t get_thread_count()
        +std::size_t get_task_count()
    }
    class worker_thread {
        +worker_thread(thread_pool *pool)
        +~worker_thread()
        +void run()
        +void wake_up()
        +void block()
        +bool is_running() const
        +bool is_waiting_for_task() const
        +bool is_paused() const
        +bool is_terminating() const
    }
    thread_pool --&gt; worker_thread : manages
</div>

<h3 id="åº“æ¶æ„">åº“æ¶æ„</h3>

<p>çº¿ç¨‹æ± é‡‡ç”¨äº†æ¨¡å—åŒ–è®¾è®¡ï¼Œä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶æ„æˆï¼š</p>

<ol>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">thread_pool</code> ç±»</strong>ï¼šä½œä¸ºç”¨æˆ·ç›´æ¥äº¤äº’çš„æ¥å£ï¼Œè´Ÿè´£ä»»åŠ¡è°ƒåº¦ã€çº¿ç¨‹ç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚ç”¨æˆ·é€šè¿‡åˆ›å»º <code class="language-plaintext highlighter-rouge">thread_pool</code> å®ä¾‹æäº¤ä»»åŠ¡ï¼Œæ§åˆ¶çº¿ç¨‹æ± çŠ¶æ€ï¼Œå¹¶è·å–çº¿ç¨‹æ± ç›¸å…³ä¿¡æ¯ã€‚</p>

    <blockquote>
      <p><a href="https://github.com/Razirp/ThreadPool/blob/main/docs/API%20docs/thread_pool.md">ç‚¹æ­¤</a>æŸ¥çœ‹ <code class="language-plaintext highlighter-rouge">thread_pool</code> ç±»çš„ API å‚è€ƒæ–‡æ¡£ã€‚</p>
    </blockquote>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">thread_pool::worker_thread</code> ç±»</strong>ï¼šä½œä¸ºçº¿ç¨‹æ± å†…éƒ¨çš„å·¥ä½œå•å…ƒï¼Œæ¯ä¸ª <code class="language-plaintext highlighter-rouge">thread_pool::worker_thread</code> å¯¹è±¡ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„å·¥ä½œçº¿ç¨‹ï¼Œè´Ÿè´£ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡å¹¶æ‰§è¡Œã€‚</p>

    <blockquote>
      <p><a href="https://github.com/Razirp/ThreadPool/blob/main/docs/API%20docs/worker_thread.md">ç‚¹æ­¤</a>æŸ¥çœ‹ <code class="language-plaintext highlighter-rouge">thread_pool::worker_thread</code> ç±»çš„ API å‚è€ƒæ–‡æ¡£ã€‚</p>
    </blockquote>
  </li>
  <li>
    <p><strong>è¾…åŠ©å·¥å…·</strong>ï¼šåŒ…æ‹¬åŒæ­¥åŸè¯­ï¼ˆå¦‚äº’æ–¥é”ã€æ¡ä»¶å˜é‡ã€ä¿¡å·é‡ç­‰ï¼‰ä»¥åŠçŠ¶æ€ç®¡ç†æœºåˆ¶ï¼Œå®ƒä»¬ä¸ºçº¿ç¨‹æ± å’Œå·¥ä½œçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€ä»»åŠ¡åŒæ­¥ã€çŠ¶æ€å˜æ›´ç­‰æ“ä½œæä¾›äº†å¿…è¦çš„æ”¯æ’‘ã€‚</p>
  </li>
</ol>

<p>å„ç»„ä»¶é—´çš„å…³ç³»å¦‚ä¸‹ï¼š</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">thread_pool</code> ç±»ç»´æŠ¤ä¸€ä¸ªå·¥ä½œçº¿ç¨‹åˆ—è¡¨ <code class="language-plaintext highlighter-rouge">std::list&lt;worker_thread&gt;</code>ï¼Œå¹¶é€šè¿‡åŒæ­¥åŸè¯­æ§åˆ¶ä»»åŠ¡é˜Ÿåˆ—çš„è®¿é—®ä¸çŠ¶æ€å˜æ›´ã€‚</li>
  <li>
<code class="language-plaintext highlighter-rouge">thread_pool::worker_thread</code> ç±»é€šè¿‡ä¸ <code class="language-plaintext highlighter-rouge">thread_pool</code> å¯¹è±¡çš„äº¤äº’ï¼Œè·å–å¾…æ‰§è¡Œä»»åŠ¡ã€æ›´æ–°è‡ªèº«çŠ¶æ€ï¼Œå¹¶å“åº”æ¥è‡ª <code class="language-plaintext highlighter-rouge">thread_pool</code> çš„æŒ‡ä»¤ï¼ˆå¦‚æš‚åœã€æ¢å¤ã€ç»ˆæ­¢ç­‰ï¼‰ã€‚</li>
  <li>è¾…åŠ©å·¥å…·è´¯ç©¿äºæ•´ä¸ªåº“çš„è®¾è®¡ä¸å®ç°ä¸­ï¼Œç¡®ä¿å¹¶å‘ç¯å¢ƒä¸‹çš„æ•°æ®ä¸€è‡´æ€§ä¸æ“ä½œå®‰å…¨æ€§ã€‚</li>
</ul>

<h3 id="å…³é”®ç±»ä¸æ¥å£">å…³é”®ç±»ä¸æ¥å£</h3>

<h4 id="thread_pool-ç±»">
<code class="language-plaintext highlighter-rouge">thread_pool</code> ç±»</h4>

<p><strong>åŠŸèƒ½å®šä½</strong>ï¼š<code class="language-plaintext highlighter-rouge">thread_pool</code> ç±»æ˜¯ç”¨æˆ·ä¸çº¿ç¨‹æ± åº“äº¤äº’çš„ä¸»è¦å…¥å£ï¼Œå°è£…äº†çº¿ç¨‹æ± åˆ›å»ºã€ä»»åŠ¡æäº¤ã€çŠ¶æ€æ§åˆ¶ã€å±æ€§è°ƒæ•´ä¸ä¿¡æ¯è·å–ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚</p>

<p><strong>ä¸»è¦API</strong>ï¼š</p>

<ul>
  <li>
    <p><strong>æ„é€ å‡½æ•°</strong>ï¼šæ¥å—åˆå§‹å·¥ä½œçº¿ç¨‹æ•°å’Œæœ€å¤§ä»»åŠ¡é˜Ÿåˆ—å®¹é‡ä½œä¸ºå‚æ•°ï¼Œåˆ›å»ºå¹¶åˆå§‹åŒ–çº¿ç¨‹æ± ã€‚</p>
  </li>
  <li>
    <p><strong>ä»»åŠ¡æäº¤</strong>ï¼šæä¾›æ¨¡æ¿æ–¹æ³• <code class="language-plaintext highlighter-rouge">submit</code>ï¼Œæ¥å—å¯è°ƒç”¨å¯¹è±¡ï¼ˆå¦‚å‡½æ•°ã€lambda è¡¨è¾¾å¼ï¼‰åŠå‚æ•°ï¼Œå°†å…¶å°è£…ä¸ºä»»åŠ¡æäº¤è‡³ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¹¶è¿”å›ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">std::future</code> å¯¹è±¡ï¼Œç”¨äºè·å–ä»»åŠ¡æ‰§è¡Œç»“æœã€‚</p>
  </li>
  <li>
<strong>çº¿ç¨‹æ± æ§åˆ¶</strong>ï¼š
    <ul>
      <li>
<strong><code class="language-plaintext highlighter-rouge">pause</code></strong>ï¼šæš‚åœçº¿ç¨‹æ± ï¼Œé˜»æ­¢æ–°ä»»åŠ¡çš„æ‰§è¡Œå¹¶æš‚åœå½“å‰è¿è¡Œçš„ä»»åŠ¡ã€‚</li>
      <li>
<strong><code class="language-plaintext highlighter-rouge">resume</code></strong>ï¼šæ¢å¤çº¿ç¨‹æ± çš„è¿è¡Œï¼Œç»§ç»­å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</li>
      <li>
<strong><code class="language-plaintext highlighter-rouge">shutdown</code></strong>ï¼šè®¾ç½®çº¿ç¨‹æ± ä¸ºç­‰å¾…ä»»åŠ¡å®ŒæˆçŠ¶æ€ï¼Œç­‰å¾…æ‰€æœ‰å·²æäº¤ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åç»ˆæ­¢çº¿ç¨‹æ± ã€‚</li>
      <li>
<strong><code class="language-plaintext highlighter-rouge">shutdown_now</code></strong>ï¼šç«‹å³ç»ˆæ­¢çº¿ç¨‹æ± ï¼Œä¸¢å¼ƒä»»åŠ¡é˜Ÿåˆ—ä¸­çš„æœªå¤„ç†ä»»åŠ¡ã€‚</li>
    </ul>
  </li>
  <li>
<strong>å±æ€§è°ƒæ•´ä¸ä¿¡æ¯è·å–</strong>ï¼š
    <ul>
      <li>
<strong><code class="language-plaintext highlighter-rouge">add_thread</code></strong>ï¼šåŠ¨æ€å‘çº¿ç¨‹æ± æ·»åŠ å·¥ä½œçº¿ç¨‹ã€‚</li>
      <li>
<strong><code class="language-plaintext highlighter-rouge">remove_thread</code></strong>ï¼šä»çº¿ç¨‹æ± ä¸­ç§»é™¤æŒ‡å®šæ•°é‡çš„å·¥ä½œçº¿ç¨‹ã€‚</li>
      <li>
<strong><code class="language-plaintext highlighter-rouge">set_max_task_count</code></strong>ï¼šé™åˆ¶ä»»åŠ¡é˜Ÿåˆ—ä¸­å…è®¸çš„æœ€å¤§ä»»åŠ¡æ•°é‡ã€‚</li>
      <li>
<strong><code class="language-plaintext highlighter-rouge">get_thread_count</code></strong>ï¼šæŸ¥è¯¢å½“å‰çº¿ç¨‹æ± ä¸­æ´»åŠ¨çš„å·¥ä½œçº¿ç¨‹æ•°ã€‚</li>
      <li>
<strong><code class="language-plaintext highlighter-rouge">get_task_count</code></strong>ï¼šæŸ¥è¯¢ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡ã€‚</li>
    </ul>
  </li>
</ul>

<h4 id="thread_poolworker_thread-ç±»å†…éƒ¨å®ç°">
<code class="language-plaintext highlighter-rouge">thread_pool::worker_thread</code> ç±»ï¼ˆå†…éƒ¨å®ç°ï¼‰</h4>

<p><strong>åŠŸèƒ½å®šä½</strong>ï¼š<code class="language-plaintext highlighter-rouge">thread_pool::worker_thread</code> ç±»æ˜¯çº¿ç¨‹æ± å†…éƒ¨çš„å·¥ä½œå•å…ƒï¼Œè´Ÿè´£ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡å¹¶æ‰§è¡Œã€‚å…¶çŠ¶æ€æœºæ¨¡å‹ã€ä»»åŠ¡å¾ªç¯é€»è¾‘ä»¥åŠå“åº”çº¿ç¨‹æ± æŒ‡ä»¤çš„æ–¹å¼ç›´æ¥å½±å“çº¿ç¨‹æ± çš„æ€§èƒ½ä¸ç¨³å®šæ€§ã€‚</p>

<p><strong>å†…éƒ¨çŠ¶æ€ä¸è¡Œä¸º</strong>ï¼š</p>

<ul>
  <li>
<strong>çŠ¶æ€æœº</strong>ï¼š<code class="language-plaintext highlighter-rouge">thread_pool::worker_thread</code> å¯¹è±¡å…·æœ‰å¤šç§çŠ¶æ€ï¼ˆå¦‚è¿è¡Œã€æš‚åœã€ç­‰å¾…ä»»åŠ¡ã€å°†ç»ˆæ­¢ã€å·²ç»ˆæ­¢ç­‰ï¼‰ï¼Œé€šè¿‡çŠ¶æ€æœºæ¨¡å‹ç®¡ç†çŠ¶æ€å˜è¿ã€‚</li>
  <li>
<strong>ä»»åŠ¡å¾ªç¯</strong>ï¼šæ¯ä¸ªå·¥ä½œçº¿ç¨‹åœ¨ä¸€ä¸ªæ— é™å¾ªç¯ä¸­ï¼Œæ ¹æ®è‡ªèº«çŠ¶æ€æ‰§è¡Œç›¸åº”æ“ä½œï¼Œå¦‚ä»ä»»åŠ¡é˜Ÿåˆ—å–ä»»åŠ¡ã€æ‰§è¡Œä»»åŠ¡ã€å“åº”çº¿ç¨‹æ± æŒ‡ä»¤ï¼ˆå¦‚æš‚åœã€æ¢å¤ã€ç»ˆæ­¢ï¼‰ç­‰ã€‚</li>
  <li>
<strong>å“åº”æŒ‡ä»¤</strong>ï¼šé€šè¿‡ç›‘å¬çº¿ç¨‹æ± çŠ¶æ€å˜æ›´ä¿¡å·å’Œæ¡ä»¶å˜é‡ï¼Œ<code class="language-plaintext highlighter-rouge">thread_pool::worker_thread</code> èƒ½å¤ŸåŠæ—¶å“åº”æ¥è‡ª <code class="language-plaintext highlighter-rouge">thread_pool</code> çš„æŒ‡ä»¤ï¼Œè°ƒæ•´è‡ªèº«çŠ¶æ€å¹¶æ‰§è¡Œç›¸åº”æ“ä½œã€‚</li>
</ul>

<h2 id="iii-å®ç°ç»†èŠ‚å‰–æ">III. å®ç°ç»†èŠ‚å‰–æ</h2>

<h3 id="çº¿ç¨‹æ± æ ¸å¿ƒæœºåˆ¶">çº¿ç¨‹æ± æ ¸å¿ƒæœºåˆ¶</h3>

<h4 id="ä»»åŠ¡é˜Ÿåˆ—">ä»»åŠ¡é˜Ÿåˆ—</h4>

<p><strong>æ•°æ®ç»“æ„é€‰æ‹©</strong>ï¼šä»»åŠ¡é˜Ÿåˆ—é‡‡ç”¨ <code class="language-plaintext highlighter-rouge">std::queue</code> å®ç°ï¼Œå®ƒæ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„æ•°æ®ç»“æ„ï¼Œç¬¦åˆçº¿ç¨‹æ± ä»»åŠ¡è°ƒåº¦çš„åŸºæœ¬åŸåˆ™â€”â€”æŒ‰æäº¤é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</p>

<p><strong>åŒæ­¥æœºåˆ¶</strong>ï¼š</p>

<ul>
  <li>
    <p><strong>äº’æ–¥é”</strong>ï¼šä½¿ç”¨ <code class="language-plaintext highlighter-rouge">std::shared_mutex</code> ä¿æŠ¤ä»»åŠ¡é˜Ÿåˆ—çš„è®¿é—®ï¼Œç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹ä»»åŠ¡é˜Ÿåˆ—çš„æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è¯»å–ä»»åŠ¡é˜Ÿåˆ—çŠ¶æ€ï¼ˆå¦‚æŸ¥è¯¢ä»»åŠ¡æ•°é‡ï¼‰æ—¶ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">std::shared_lock</code>ï¼Œä»…éœ€è¯»å–æƒé™ï¼›å‘é˜Ÿåˆ—æ·»åŠ æˆ–ç§»é™¤ä»»åŠ¡æ—¶ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">std::unique_lock</code>ï¼Œéœ€è¦ç‹¬å è®¿é—®æƒé™ã€‚</p>
  </li>
  <li>
    <p><strong>æ¡ä»¶å˜é‡</strong>ï¼šä½¿ç”¨ <code class="language-plaintext highlighter-rouge">std::condition_variable_any</code> åè°ƒçº¿ç¨‹é—´çš„åŒæ­¥ã€‚å½“ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œç­‰å¾…ä»»åŠ¡çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æœ‰æ–°ä»»åŠ¡å…¥é˜Ÿæˆ–çº¿ç¨‹æ± çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œé€šè¿‡æ¡ä»¶å˜é‡å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚</p>
  </li>
</ul>

<h4 id="å·¥ä½œçº¿ç¨‹ç®¡ç†">å·¥ä½œçº¿ç¨‹ç®¡ç†</h4>

<p><strong>åˆ›å»ºä¸é”€æ¯</strong>ï¼šåœ¨ <code class="language-plaintext highlighter-rouge">thread_pool</code> æ„é€ å‡½æ•°ä¸­åˆ›å»ºæŒ‡å®šæ•°é‡çš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶å°†å®ƒä»¬åŠ å…¥å·¥ä½œçº¿ç¨‹åˆ—è¡¨ã€‚çº¿ç¨‹æ± ææ„æ—¶ï¼Œé€šè¿‡è°ƒç”¨<code class="language-plaintext highlighter-rouge">thread_pool::worker_thread</code>çš„<code class="language-plaintext highlighter-rouge">terminate</code>æ–¹æ³•ç»ˆæ­¢æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼Œå¹¶ç­‰å¾…å…¶é€€å‡ºã€‚</p>

<p><strong>çŠ¶æ€åˆ‡æ¢</strong>ï¼š</p>

<ul>
  <li>
<strong>çº¿ç¨‹çŠ¶æ€</strong>ï¼šä½¿ç”¨ <code class="language-plaintext highlighter-rouge">std::atomic&lt;&gt;</code> å­˜å‚¨çº¿ç¨‹çŠ¶æ€ï¼Œç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çŠ¶æ€å˜æ›´çš„åŸå­æ€§ã€‚
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">std::atomic&lt;&gt;</code> æ˜¯ C++ æ ‡å‡†åº“ä¸­çš„åŸå­å˜é‡ç±»å‹ï¼Œå¯ä»¥ä¿è¯å¯¹è¯¥ç±»å‹çš„å¯¹è±¡çš„è¯»/å†™ç­‰æ“ä½œæ˜¯åŸå­çš„ã€‚</li>
    </ul>
  </li>
  <li>
<strong>åŒæ­¥åŸè¯­</strong>ï¼š
    <ul>
      <li>
<strong>äº’æ–¥é”</strong>ï¼šä¿æŠ¤çº¿ç¨‹çŠ¶æ€çš„è®¿é—®ï¼Œç¡®ä¿çŠ¶æ€å˜æ›´æ“ä½œçš„åŸå­æ€§ã€‚</li>
      <li>
<strong>æ¡ä»¶å˜é‡</strong>ï¼šç”¨äºå·¥ä½œçº¿ç¨‹ç­‰å¾…ä»»åŠ¡ã€å“åº”çº¿ç¨‹æ± æŒ‡ä»¤ç­‰åœºæ™¯ï¼Œå®ç°çº¿ç¨‹é—´çš„åŒæ­¥ã€‚</li>
      <li>
<strong>ä¿¡å·é‡</strong>ï¼šåœ¨ <code class="language-plaintext highlighter-rouge">thread_pool::worker_thread</code> ç±»ä¸­ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">std::binary_semaphore</code> å®ç°çº¿ç¨‹çš„æš‚åœä¸æ¢å¤ã€‚</li>
    </ul>
  </li>
</ul>

<h4 id="çº¿ç¨‹æ± çŠ¶æ€æœº">çº¿ç¨‹æ± çŠ¶æ€æœº</h4>

<div class="mermaid">
stateDiagram-v2
    [*] --&gt; RUNNING : åˆå§‹åŒ–
    RUNNING --&gt; PAUSED : æš‚åœ-pause()
    PAUSED --&gt; RUNNING : æ¢å¤-resume()
    RUNNING --&gt; SHUTDOWN : shutdown()
    RUNNING --&gt; TERMINATING : shutdown_now()/terminate()
    PAUSED --&gt; TERMINATING : shutdown_now()/terminate()
    SHUTDOWN --&gt; TERMINATING : æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    TERMINATING --&gt; TERMINATED : æ‰€æœ‰çº¿ç¨‹ç»ˆæ­¢
</div>

<p><strong>çŠ¶æ€æšä¸¾å®šä¹‰</strong>ï¼šå®šä¹‰äº†å¦‚<code class="language-plaintext highlighter-rouge">RUNNING</code>ã€<code class="language-plaintext highlighter-rouge">PAUSED</code>ã€<code class="language-plaintext highlighter-rouge">SHUTDOWN</code>ç­‰çŠ¶æ€æšä¸¾å€¼ï¼Œç”¨äºè¡¨ç¤ºçº¿ç¨‹æ± çš„ä¸åŒè¿è¡ŒçŠ¶æ€ã€‚</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">enum</span> <span class="k">class</span> <span class="nc">status_t</span> <span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="kt">int8_t</span> <span class="p">{</span> 
        <span class="n">TERMINATED</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> 
        <span class="n">TERMINATING</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
        <span class="n">RUNNING</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
        <span class="n">PAUSED</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> 
        <span class="n">SHUTDOWN</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="p">};</span>  <span class="c1">// çº¿ç¨‹æ± çš„çŠ¶æ€ï¼Œ-1: çº¿ç¨‹æ± å·²ç»ˆæ­¢ï¼›0: çº¿ç¨‹æ± å°†ç»ˆæ­¢ï¼›1: çº¿ç¨‹æ± æ­£åœ¨è¿è¡Œï¼›2: çº¿ç¨‹æ± è¢«æš‚åœï¼›3: çº¿ç¨‹æ± åœ¨ç­‰å¾…ä»»åŠ¡å®Œæˆï¼Œä½†ä¸å†æ¥å—æ–°ä»»åŠ¡</span>
</code></pre></div></div>

<p><strong>çŠ¶æ€å˜æ›´æ“ä½œ</strong>ï¼š</p>

<ul>
  <li>
    <p><strong>åŸå­æ€§ä¿è¯</strong>ï¼šé€šè¿‡åœ¨çŠ¶æ€å˜æ›´æ“ä½œå‰ååŠ é”è§£é” <code class="language-plaintext highlighter-rouge">status_mutex</code>ï¼Œç¡®ä¿çŠ¶æ€å˜æ›´çš„åŸå­æ€§ã€‚</p>
  </li>
  <li>
    <p><strong>å¹¶å‘å®‰å…¨æ€§</strong>ï¼šåœ¨çŠ¶æ€å˜æ›´æ—¶ï¼Œé€šè¿‡æ£€æŸ¥å½“å‰çŠ¶æ€å¹¶ç›¸åº”åœ°è°ƒæ•´çº¿ç¨‹æ± åŠå·¥ä½œçº¿ç¨‹çš„è¡Œä¸ºï¼Œç¡®ä¿åœ¨å¹¶å‘ç¯å¢ƒä¸‹çš„æ­£ç¡®æ€§ä¸ä¸€è‡´æ€§ã€‚</p>
  </li>
</ul>

<h3 id="ä»»åŠ¡è°ƒåº¦ä¸æ‰§è¡Œ">ä»»åŠ¡è°ƒåº¦ä¸æ‰§è¡Œ</h3>

<div class="mermaid">
graph TD
    subgraph çº¿ç¨‹æ± 
    TP(thread_pool)
    end

    subgraph å·¥ä½œçº¿ç¨‹
    WT(worker_thread)
    end

    U\[ç”¨æˆ·] --&gt; |æäº¤ä»»åŠ¡| TP
    TP --&gt;|ä»»åŠ¡å…¥é˜Ÿ| TP
    TP --&gt;|æç¤ºå·¥ä½œçº¿ç¨‹æœ‰æ–°ä»»åŠ¡| WT
    WT --&gt;|ç­‰å¾…ä»»åŠ¡| WT
    WT --&gt;|å–ä»»åŠ¡| WT
    WT --&gt;|æ‰§è¡Œä»»åŠ¡| WT
    WT --&gt;|å°†ä»»åŠ¡é˜Ÿåˆ—å–è‡³ç©ºæ—¶æç¤ºçº¿ç¨‹æ± | TP
</div>

<h4 id="ä»»åŠ¡æäº¤">ä»»åŠ¡æäº¤</h4>

<p><strong><code class="language-plaintext highlighter-rouge">submit</code> æ–¹æ³•å®ç°</strong>ï¼š</p>

<blockquote>
  <p>ä»£ç è§ <a href="https://github.com/Razirp/ThreadPool/blob/main/include/thread_pool.hpp">GitHub</a> æˆ– <a href="##`submit()`%20%E4%BB%BB%E5%8A%A1%E6%8F%90%E4%BA%A4%E5%87%BD%E6%95%B0">é™„å½•</a>ã€‚</p>
</blockquote>

<ol>
  <li>
    <p><strong>æ¨¡æ¿å‡½æ•°åŒ…è£…</strong>ï¼šæ¥å—å¯è°ƒç”¨å¯¹è±¡ï¼ˆå¦‚å‡½æ•°ã€lambdaè¡¨è¾¾å¼ï¼‰åŠå‚æ•°ï¼Œåˆ©ç”¨æ¨¡æ¿å‚æ•°æ¨å¯¼ï¼Œå°†ä»»åŠ¡åŠå…¶å‚æ•°å°è£…ä¸ºä¸€ä¸ªæ— å‚çš„ <code class="language-plaintext highlighter-rouge">std::function&lt;void()&gt;</code>ã€‚</p>

    <blockquote>
      <p>å°è£…ä¸ºæ— å‚å‡½æ•°å¯¹è±¡æ˜¯ä¸ºäº†ï¼Œåœ¨å·¥ä½œçº¿ç¨‹ä¸­å¯ä»¥ç”¨ç»Ÿä¸€çš„æ ¼å¼ï¼ˆç›´æ¥ç”¨ <code class="language-plaintext highlighter-rouge">()</code> è¿›è¡Œè°ƒç”¨ï¼‰å¯¹ä»»ä½•å½¢å¼çš„ä»»åŠ¡è¿›è¡Œè°ƒç”¨æ‰§è¡Œã€‚</p>
    </blockquote>
  </li>
  <li>
    <p><strong>ä»»åŠ¡å°è£…</strong>ï¼šä½¿ç”¨ <code class="language-plaintext highlighter-rouge">std::packaged_task</code> å°†ä»»åŠ¡åŒ…è£…ä¸ºå¯è·å–å¼‚æ­¥ç»“æœçš„å¯¹è±¡ï¼Œå¹¶é€šè¿‡å…¶ <code class="language-plaintext highlighter-rouge">get_future</code> æ–¹æ³•è·å–ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">std::future</code>ï¼Œç”¨äºåç»­è·å–ä»»åŠ¡æ‰§è¡Œç»“æœã€‚</p>
  </li>
  <li>
    <p><strong>å…¥é˜Ÿ</strong>ï¼šåœ¨ç¡®ä¿çº¿ç¨‹æ± çŠ¶æ€ç¨³å®šçš„å‰æä¸‹ï¼Œå°†ä»»åŠ¡æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¹¶é€šè¿‡æ¡ä»¶å˜é‡é€šçŸ¥ç­‰å¾…ä»»åŠ¡çš„å·¥ä½œçº¿ç¨‹ã€‚</p>
  </li>
</ol>

<h4 id="å·¥ä½œçº¿ç¨‹ä»»åŠ¡å¾ªç¯">å·¥ä½œçº¿ç¨‹ä»»åŠ¡å¾ªç¯</h4>

<p><strong>é€»è¾‘æµç¨‹</strong>ï¼š</p>

<blockquote>
  <p>ä»£ç è§ <a href="https://github.com/Razirp/ThreadPool/blob/main/src/worker_thread.cpp">GitHub</a> æˆ– <a href="##%E5%B7%A5%E4%BD%9C%E7%BA%BF%E7%A8%8B%E4%BB%BB%E5%8A%A1%E5%BE%AA%E7%8E%AF%E7%9A%84%E9%80%BB%E8%BE%91">é™„å½•</a>ã€‚</p>
</blockquote>

<ol>
  <li>
    <p><strong>è·å–ä»»åŠ¡</strong>ï¼šåœ¨å¾ªç¯ä¸­ï¼Œå·¥ä½œçº¿ç¨‹é¦–å…ˆæ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€ï¼Œæ ¹æ®çŠ¶æ€å†³å®šæ˜¯å¦ç»§ç»­æ‰§è¡Œä»»åŠ¡æˆ–è¿›è¡Œå…¶ä»–æ“ä½œï¼ˆå¦‚æš‚åœã€ç­‰å¾…ä»»åŠ¡ã€ç»ˆæ­¢ç­‰ï¼‰ã€‚</p>
  </li>
  <li>
    <p><strong>æ‰§è¡Œä»»åŠ¡</strong>ï¼šä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡å¹¶æ‰§è¡Œã€‚å¦‚æœä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œæ•è·å¹¶è®°å½•å¼‚å¸¸ä¿¡æ¯ï¼Œç„¶åç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚</p>
  </li>
  <li>
    <p><strong>ç­‰å¾…æ–°ä»»åŠ¡</strong>ï¼šå½“ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œå·¥ä½œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°æœ‰æ–°ä»»åŠ¡å…¥é˜Ÿæˆ–çº¿ç¨‹æ± çŠ¶æ€å˜åŒ–æ—¶è¢«å”¤é†’ã€‚</p>
  </li>
  <li>
    <p><strong>å“åº”çº¿ç¨‹æ± æŒ‡ä»¤</strong>ï¼šæ ¹æ®çº¿ç¨‹æ± çŠ¶æ€å˜æ›´ï¼Œå¦‚æ¥æ”¶åˆ°æš‚åœã€æ¢å¤ã€ç»ˆæ­¢ç­‰æŒ‡ä»¤ï¼Œå·¥ä½œçº¿ç¨‹è°ƒæ•´è‡ªèº«çŠ¶æ€å¹¶æ‰§è¡Œç›¸åº”æ“ä½œã€‚</p>
  </li>
</ol>

<h2 id="iv-åº“ç‰¹æ€§ä¸ä¼˜åŒ–">IV. åº“ç‰¹æ€§ä¸ä¼˜åŒ–</h2>

<h3 id="åŠ¨æ€çº¿ç¨‹è°ƒæ•´">åŠ¨æ€çº¿ç¨‹è°ƒæ•´</h3>

<div class="mermaid">
sequenceDiagram
    participant ç”¨æˆ·
    participant çº¿ç¨‹æ± 
    participant å·¥ä½œçº¿ç¨‹

    ç”¨æˆ·-&gt;&gt;çº¿ç¨‹æ± : add_thread(count)
    çº¿ç¨‹æ± -&gt;&gt;å·¥ä½œçº¿ç¨‹: å®ä¾‹åŒ– count ä¸ªå·¥ä½œçº¿ç¨‹å¯¹è±¡
    å·¥ä½œçº¿ç¨‹--&gt;&gt;çº¿ç¨‹æ± : å·¥ä½œçº¿ç¨‹åˆ›å»ºå®Œæ¯•

    ç”¨æˆ·-&gt;&gt;çº¿ç¨‹æ± : remove_thread(count)
    çº¿ç¨‹æ± -&gt;&gt;å·¥ä½œçº¿ç¨‹: ç»ˆæ­¢å¹¶ææ„ count ä¸ªå·¥ä½œçº¿ç¨‹å¯¹è±¡
    å·¥ä½œçº¿ç¨‹--&gt;&gt;çº¿ç¨‹æ± : å·¥ä½œçº¿ç¨‹ç»ˆæ­¢å¹¶ææ„å®Œæ¯•
</div>

<p><strong><code class="language-plaintext highlighter-rouge">add_thread</code> ä¸ <code class="language-plaintext highlighter-rouge">remove_thread</code> æ–¹æ³•</strong>ï¼š</p>

<ul>
  <li>
    <p><strong>å®ç°</strong>ï¼šè¿™ä¸¤ä¸ªæ–¹æ³•å…è®¸ç”¨æˆ·åœ¨è¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹æ•°é‡ã€‚<code class="language-plaintext highlighter-rouge">add_thread</code> åˆ›å»ºæ–°çš„ <code class="language-plaintext highlighter-rouge">thread_pool::worker_thread</code> å¯¹è±¡å¹¶åŠ å…¥å·¥ä½œçº¿ç¨‹åˆ—è¡¨ï¼Œ <code class="language-plaintext highlighter-rouge">remove_thread</code> åˆ™é€‰æ‹©é€‚å½“çš„å·¥ä½œçº¿ç¨‹ç»ˆæ­¢å¹¶ä»åˆ—è¡¨ä¸­ç§»é™¤ã€‚</p>

    <ul>
      <li>
        <blockquote>
          <p>å½“æƒ³è¦ç§»é™¤çš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äºå½“å‰å·¥ä½œçº¿ç¨‹æ•°æ—¶ï¼Œä¼šå°†æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ç§»é™¤ã€‚</p>
        </blockquote>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šåœ¨ä»»åŠ¡è´Ÿè½½å˜åŒ–è¾ƒå¤§æˆ–éœ€è¦é’ˆå¯¹ç‰¹å®šç¡¬ä»¶èµ„æºè¿›è¡Œä¼˜åŒ–æ—¶ï¼ŒåŠ¨æ€è°ƒæ•´å·¥ä½œçº¿ç¨‹æ•°æœ‰åŠ©äºä¿æŒè‰¯å¥½çš„ç³»ç»Ÿæ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œå½“ä»»åŠ¡æ•°é‡æ¿€å¢æ—¶ï¼Œå¢åŠ å·¥ä½œçº¿ç¨‹å¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨ï¼Œæé«˜ä»»åŠ¡å¤„ç†é€Ÿåº¦ï¼›åä¹‹ï¼Œåœ¨ä»»åŠ¡ç¨€ç–æ—¶å‡å°‘å·¥ä½œçº¿ç¨‹ï¼Œå¯é¿å…èµ„æºæµªè´¹å’Œè¿‡åº¦ç«äº‰ã€‚</p>
  </li>
</ul>

<p><strong>æ€§èƒ½å½±å“åˆ†æ</strong>ï¼š</p>

<ul>
  <li>
    <p><strong>ç§¯æå½±å“</strong>ï¼šåŠ¨æ€è°ƒæ•´çº¿ç¨‹æ•°æœ‰åŠ©äºé€‚åº”è´Ÿè½½æ³¢åŠ¨ï¼Œé¿å…çº¿ç¨‹è¿‡å¤šå¯¼è‡´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å’Œèµ„æºäº‰æŠ¢ï¼Œæˆ–çº¿ç¨‹è¿‡å°‘å¯¼è‡´çš„å¤„ç†å™¨åˆ©ç”¨ç‡ä½ä¸‹ã€‚</p>
  </li>
  <li>
    <p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼šé¢‘ç¹è°ƒæ•´çº¿ç¨‹æ•°å¯èƒ½å¯¼è‡´æ€§èƒ½æ³¢åŠ¨å’Œé¢å¤–å¼€é”€ã€‚åº”æ ¹æ®å®é™…åº”ç”¨éœ€æ±‚å’Œç›‘æ§æ•°æ®ï¼Œé€‚åº¦ã€é€‚æ—¶åœ°è°ƒæ•´çº¿ç¨‹æ•°ï¼Œä»¥è¾¾åˆ°æœ€ä½³æ€§èƒ½å¹³è¡¡ã€‚</p>
  </li>
</ul>

<h4 id="ä»»åŠ¡é˜Ÿåˆ—å®¹é‡é™åˆ¶">ä»»åŠ¡é˜Ÿåˆ—å®¹é‡é™åˆ¶</h4>

<p><strong><code class="language-plaintext highlighter-rouge">set_max_task_count</code> æ–¹æ³•</strong>ï¼š</p>

<ul>
  <li>
    <p><strong>å®ç°</strong>ï¼šè¯¥æ–¹æ³•ç”¨äºè®¾ç½®ä»»åŠ¡é˜Ÿåˆ—å…è®¸çš„æœ€å¤§ä»»åŠ¡æ•°é‡ã€‚å½“ä»»åŠ¡é˜Ÿåˆ—æ¥è¿‘æˆ–è¾¾åˆ°æœ€å¤§å®¹é‡æ—¶ï¼Œæ–°æäº¤çš„ä»»åŠ¡å°†è¢«æ‹’ç»ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯æç¤ºã€‚</p>
  </li>
  <li>
    <p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šåœ¨å¤„ç†é«˜ä¼˜å…ˆçº§ä»»åŠ¡æˆ–èµ„æºæœ‰é™çš„åœºæ™¯ä¸‹ï¼Œé™åˆ¶ä»»åŠ¡é˜Ÿåˆ—å®¹é‡æœ‰åŠ©äºé¿å…ä½ä¼˜å…ˆçº§ä»»åŠ¡ç§¯å‹ï¼Œç¡®ä¿é«˜ä¼˜å…ˆçº§ä»»åŠ¡å¾—åˆ°åŠæ—¶å¤„ç†ã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è°ƒæ•´ä»»åŠ¡é˜Ÿåˆ—å®¹é‡æ¥æ§åˆ¶ç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨ï¼Œé˜²æ­¢å› ä»»åŠ¡å †ç§¯å¯¼è‡´çš„å†…å­˜æº¢å‡ºã€‚</p>

    <ul>
      <li>
        <blockquote>
          <p>å¯¹ä»»åŠ¡ä¼˜å…ˆçº§çš„ç‰¹æ€§è¿˜æœ‰å¾…å®ç°ã€‚</p>
        </blockquote>
      </li>
    </ul>
  </li>
</ul>

<p><strong>æ‹’ç»ç­–ç•¥</strong>ï¼š</p>

<ul>
  <li>
<strong>æŠ›å‡ºå¼‚å¸¸</strong>ï¼šå½“ä»»åŠ¡é˜Ÿåˆ—æ»¡ä¸”æ–°ä»»åŠ¡è¢«æ‹’ç»æ—¶ï¼Œ<code class="language-plaintext highlighter-rouge">submit</code> æ–¹æ³•æŠ›å‡º <code class="language-plaintext highlighter-rouge">std::runtime_error</code> å¼‚å¸¸ï¼Œé€šçŸ¥è°ƒç”¨è€…æ— æ³•æäº¤ä»»åŠ¡ã€‚</li>
</ul>

<h3 id="çº¿ç¨‹æ± ä¼˜é›…å…³é—­ä¸å³æ—¶ç»ˆæ­¢">çº¿ç¨‹æ± ä¼˜é›…å…³é—­ä¸å³æ—¶ç»ˆæ­¢</h3>

<p><strong><code class="language-plaintext highlighter-rouge">shutdown</code> ä¸ <code class="language-plaintext highlighter-rouge">shutdown_now</code> æ–¹æ³•</strong>ï¼š</p>

<ul>
  <li>
    <p><strong>ä¼˜é›…å…³é—­</strong>ï¼š<code class="language-plaintext highlighter-rouge">shutdown</code> æ–¹æ³•å°†çº¿ç¨‹æ± è®¾ç½®ä¸ºç­‰å¾…ä»»åŠ¡å®ŒæˆçŠ¶æ€ï¼Œå…è®¸å·²æäº¤çš„ä»»åŠ¡ç»§ç»­æ‰§è¡Œï¼Œä½†ä¸å†æ¥å—æ–°ä»»åŠ¡ã€‚æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œçº¿ç¨‹æ± è‡ªåŠ¨ç»ˆæ­¢ã€‚</p>
  </li>
  <li>
    <p><strong>å³æ—¶ç»ˆæ­¢</strong>ï¼š<code class="language-plaintext highlighter-rouge">shutdown_now</code> æ–¹æ³•ç«‹å³åœæ­¢çº¿ç¨‹æ± ï¼Œä¸¢å¼ƒä»»åŠ¡é˜Ÿåˆ—ä¸­çš„æœªå¤„ç†ä»»åŠ¡ï¼Œå·¥ä½œçº¿ç¨‹ç«‹å³ç»“æŸæ‰§è¡Œã€‚</p>
  </li>
</ul>

<p><strong>èµ„æºæ¸…ç†ä¸å®Œæ•´æ€§</strong>ï¼š</p>

<ul>
  <li>
    <p><strong>èµ„æºé‡Šæ”¾</strong>ï¼šåœ¨ç»ˆæ­¢çº¿ç¨‹æ± æ—¶ï¼Œç¡®ä¿æ‰€æœ‰å·¥ä½œçº¿ç¨‹è¢«æ­£ç¡®åœ°ç»ˆæ­¢å¹¶ç­‰å¾…å…¶é€€å‡ºï¼ŒåŒæ—¶æ¸…ç†ç›¸å…³èµ„æºï¼Œå¦‚é‡Šæ”¾äº’æ–¥é”ã€æ¡ä»¶å˜é‡ç­‰ã€‚</p>
  </li>
  <li>
    <p><strong>ä»»åŠ¡å®Œæ•´æ€§</strong>ï¼šä½¿ç”¨ <code class="language-plaintext highlighter-rouge">shutdown</code> æ–¹æ³•å¯ä»¥ä¿è¯æ‰€æœ‰å·²æäº¤ä»»åŠ¡å¾—åˆ°å®Œæ•´æ‰§è¡Œï¼Œé€‚ç”¨äºéœ€è¦ä¿è¯ä»»åŠ¡ç»“æœçš„åœºæ™¯ï¼›è€Œ <code class="language-plaintext highlighter-rouge">shutdown_now</code> é€‚ç”¨äºç´§æ€¥æƒ…å†µæˆ–æµ‹è¯•ç¯å¢ƒï¼Œå¯èƒ½ç‰ºç‰²éƒ¨åˆ†æœªå®Œæˆä»»åŠ¡çš„å®Œæ•´æ€§ã€‚</p>
  </li>
</ul>

<h2 id="v-ç¤ºä¾‹ä»£ç ä¸åº”ç”¨ç¤ºä¾‹">V. ç¤ºä¾‹ä»£ç ä¸åº”ç”¨ç¤ºä¾‹</h2>

<h3 id="åŸºç¡€ä½¿ç”¨ç¤ºä¾‹">åŸºç¡€ä½¿ç”¨ç¤ºä¾‹</h3>

<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨C++çº¿ç¨‹æ± åº“çš„åŸºæœ¬ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åˆ›å»ºçº¿ç¨‹æ± ã€æäº¤ä¸åŒç±»å‹ä»»åŠ¡ã€æ§åˆ¶çº¿ç¨‹æ± çŠ¶æ€ç­‰æ“ä½œã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"thread_pool.hpp"</span><span class="cp">
</span>
<span class="c1">// å®šä¹‰ä¸€ä¸ªç®€å•çš„è®¡ç®—ä»»åŠ¡</span>
<span class="kt">double</span> <span class="nf">compute</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">y</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// åˆ›å»ºä¸€ä¸ªåˆå§‹åŒ…å«4ä¸ªå·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä»»åŠ¡é˜Ÿåˆ—æœ€å¤§å®¹é‡ä¸º100</span>
    <span class="n">thread_utils</span><span class="o">::</span><span class="n">thread_pool</span> <span class="n">pool</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

    <span class="c1">// æäº¤ä¸€ä¸ªè®¡ç®—ä»»åŠ¡ï¼Œè¿”å›ç»“æœçš„future</span>
    <span class="k">auto</span> <span class="n">future</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">compute</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

    <span class="c1">// æäº¤ä¸€ä¸ªlambdaä»»åŠ¡</span>
    <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">([]()</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Hello from a lambda task!"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="c1">// æš‚åœçº¿ç¨‹æ± ï¼Œé˜»æ­¢æ–°ä»»åŠ¡çš„æ‰§è¡Œ</span>
    <span class="n">pool</span><span class="p">.</span><span class="n">pause</span><span class="p">();</span>

    <span class="c1">// ...åœ¨æ­¤æœŸé—´å¯ä»¥è¿›è¡Œå…¶ä»–æ“ä½œ...</span>

    <span class="c1">// æ¢å¤çº¿ç¨‹æ± ï¼Œç»§ç»­å¤„ç†ä»»åŠ¡</span>
    <span class="n">pool</span><span class="p">.</span><span class="n">resume</span><span class="p">();</span>

    <span class="c1">// ç­‰å¾…è®¡ç®—ä»»åŠ¡å®Œæˆå¹¶è·å–ç»“æœ</span>
    <span class="kt">double</span> <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Result: "</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="c1">// å…³é—­çº¿ç¨‹æ± ï¼Œç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span>
    <span class="n">pool</span><span class="p">.</span><span class="n">shutdown</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="å®é™…åº”ç”¨æ¡ˆä¾‹">å®é™…åº”ç”¨æ¡ˆä¾‹</h3>

<p>å‡è®¾æˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªWebæœåŠ¡å™¨ï¼Œéœ€è¦å¤„ç†å¤§é‡å¹¶å‘çš„HTTPè¯·æ±‚ã€‚ä½¿ç”¨C++çº¿ç¨‹æ± åº“ï¼Œå¯ä»¥ç®€åŒ–è¯·æ±‚å¤„ç†çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œæé«˜æœåŠ¡å™¨æ€§èƒ½ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"thread_pool.hpp"</span><span class="cp">
#include</span> <span class="cpf">"http_request.h"</span><span class="c1">  // å‡è®¾å·²å®šä¹‰HttpRequestç±»</span><span class="cp">
</span>
<span class="c1">// å®šä¹‰å¤„ç†HTTPè¯·æ±‚çš„å›è°ƒå‡½æ•°</span>
<span class="kt">void</span> <span class="nf">handle_request</span><span class="p">(</span><span class="k">const</span> <span class="n">HttpRequest</span><span class="o">&amp;</span> <span class="n">request</span><span class="p">,</span> <span class="n">HttpResponse</span><span class="o">&amp;</span> <span class="n">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...å®é™…å¤„ç†é€»è¾‘...</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// åˆ›å»ºä¸€ä¸ªåˆå§‹åŒ…å«8ä¸ªå·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä»»åŠ¡é˜Ÿåˆ—æ— å®¹é‡é™åˆ¶</span>
    <span class="n">thread_utils</span><span class="o">::</span><span class="n">thread_pool</span> <span class="n">pool</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>

    <span class="c1">// å¾ªç¯æ¥æ”¶å¹¶å¤„ç†HTTPè¯·æ±‚</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">HttpRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="n">receive_request</span><span class="p">();</span>  <span class="c1">// å‡è®¾receive_requestä»ç½‘ç»œæ¥æ”¶ä¸€ä¸ªè¯·æ±‚</span>
        <span class="n">HttpResponse</span> <span class="n">response</span><span class="p">;</span>

        <span class="c1">// å°†è¯·æ±‚å¤„ç†ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± </span>
        <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">([</span><span class="n">request</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">response</span><span class="p">]()</span> <span class="p">{</span>
            <span class="n">handle_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">);</span>
            <span class="n">send_response</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>  <span class="c1">// å‡è®¾send_responseå°†å¤„ç†ç»“æœå‘é€å›å®¢æˆ·ç«¯</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="c1">// ...åœ¨é€‚å½“æ—¶å€™è°ƒç”¨pool.shutdown()å…³é—­çº¿ç¨‹æ± ...</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<hr>

<p>ä»¥ä¸Šç¤ºä¾‹ä»£ç å±•ç¤ºäº†å¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨C++çº¿ç¨‹æ± åº“æäº¤å¹¶è¡Œä»»åŠ¡ã€æ§åˆ¶çº¿ç¨‹æ± çŠ¶æ€ä»¥åŠå¤„ç†ç‰¹å®šåº”ç”¨éœ€æ±‚ã€‚é€šè¿‡è¿™äº›ç¤ºä¾‹ï¼Œè¯»è€…å¯ä»¥ç›´è§‚åœ°ç†è§£åº“çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¹¶å°†å…¶åº”ç”¨åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ã€‚</p>

<h2 id="vi-æ€§èƒ½æµ‹è¯•ä¸å¯¹æ¯”">VI. æ€§èƒ½æµ‹è¯•ä¸å¯¹æ¯”</h2>

<blockquote>
  <p>é™äºæ—¶é—´å’Œç²¾åŠ›ï¼Œç›®å‰ä»…å¯¹æœ¬çº¿ç¨‹æ± åº“è¿›è¡Œäº†ç®€å•çš„åŠŸèƒ½å’Œæ€§èƒ½æµ‹è¯•ã€‚æœ¬éƒ¨åˆ†å†…å®¹æœ‰å¾…è¿›ä¸€æ­¥å·¥ä½œæ¥å®Œå–„ã€‚åŒæ—¶æˆ‘ä»¬æ¬¢è¿æœ‰å…´è¶£çš„ç¤¾åŒºæˆå‘˜å‘æœ¬é¡¹ç›®æä¾›æ‚¨è¿›è¡Œçš„æ€§èƒ½æµ‹è¯•ä¸å¯¹æ¯”çš„åŸºå‡†åŠå…¶ç»“æœï¼</p>
</blockquote>

<h3 id="ç®€å•çš„åŠŸèƒ½æµ‹è¯•">ç®€å•çš„åŠŸèƒ½æµ‹è¯•</h3>

<p>ç®€å•åœ°æµ‹è¯•äº†ä¸€ä¸‹çº¿ç¨‹æ± çš„ä»»åŠ¡æäº¤ã€ç»“æœè·å–ã€ä»»åŠ¡æŠ›å‡ºå¼‚å¸¸ã€æš‚åœ/æ¢å¤çº¿ç¨‹æ± ã€å¢åŠ /åˆ é™¤çº¿ç¨‹ã€è®¾ç½®æœ€å¤§ä»»åŠ¡é˜Ÿåˆ—é•¿åº¦ã€ç»ˆæ­¢çº¿ç¨‹ç­‰åŸºæœ¬çš„çº¿ç¨‹æ± åŠŸèƒ½ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;cassert&gt;</span><span class="cp">
#include</span> <span class="cpf">"thread_pool.hpp"</span><span class="cp">
</span>
<span class="c1">// Test function</span>
<span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Test function that throws an exception</span>
<span class="kt">void</span> <span class="nf">throw_exception</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"Test exception"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Create a thread pool with 4 threads</span>
    <span class="n">thread_utils</span><span class="o">::</span><span class="n">thread_pool</span> <span class="n">pool</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

    <span class="c1">// Test submitting a task and getting the result</span>
    <span class="k">auto</span> <span class="n">future</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">future</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="mi">5</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Test 1 passed!"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="c1">// Test submitting multiple tasks</span>
    <span class="k">auto</span> <span class="n">future1</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">future2</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">future1</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="mi">9</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">future2</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="mi">13</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Test 2 passed!"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="c1">// Test submitting tasks that throw exceptions</span>
    <span class="k">auto</span> <span class="n">future3</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">throw_exception</span><span class="p">);</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">future3</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
        <span class="n">assert</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span> <span class="c1">// Should not reach here</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">())</span> <span class="o">==</span> <span class="s">"Test exception"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Test 3 passed!"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="c1">// Test pausing and resuming the thread pool</span>
    <span class="n">pool</span><span class="p">.</span><span class="n">pause</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span> <span class="c1">// Should throw exception because pool is paused</span>
        <span class="n">assert</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span> <span class="c1">// Should not reach here</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">())</span> <span class="o">==</span> <span class="s">"[thread_pool::submit][error]: thread pool is paused"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">pool</span><span class="p">.</span><span class="n">resume</span><span class="p">();</span>
    <span class="k">auto</span> <span class="n">future4</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">future4</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="mi">17</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Test 4 passed!"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="c1">// Test adding and removing threads from the pool</span>
    <span class="n">pool</span><span class="p">.</span><span class="n">add_thread</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">pool</span><span class="p">.</span><span class="n">get_thread_count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">6</span><span class="p">);</span>
    <span class="n">pool</span><span class="p">.</span><span class="n">remove_thread</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">pool</span><span class="p">.</span><span class="n">get_thread_count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Test 5 passed!"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">pool</span><span class="p">.</span><span class="n">get_task_count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="c1">// Test setting the maximum task count</span>
    <span class="n">pool</span><span class="p">.</span><span class="n">set_max_task_count</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">future5</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">future6</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">);</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">);</span> <span class="c1">// Should throw exception because task queue is full</span>
        <span class="n">assert</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span> <span class="c1">// Should not reach here</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">())</span> <span class="o">==</span> <span class="s">"[thread_pool::submit][error]: task queue is full"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Test 6 passed!"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="c1">// Test shutting down the thread pool</span>
    <span class="n">pool</span><span class="p">.</span><span class="n">shutdown</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">);</span> <span class="c1">// Should throw exception because pool is shutting down</span>
        <span class="n">assert</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span> <span class="c1">// Should not reach here</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">())</span> <span class="o">==</span> <span class="s">"[thread_pool::submit][error]: thread pool is terminated"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Test 7 passed!"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"All tests passed!"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="ç®€å•çš„æ€§èƒ½æµ‹è¯•">ç®€å•çš„æ€§èƒ½æµ‹è¯•</h3>

<p>ç®€å•åœ°å¯¹æ¯”äº†ä¸€ä¸‹ä½¿ç”¨çº¿ç¨‹æ± å’Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡çš„æ‰€éœ€æ—¶é—´çš„å·®åˆ«ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp">
#include</span> <span class="cpf">"thread_pool.hpp"</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Create a thread pool object</span>
    <span class="n">thread_utils</span><span class="o">::</span><span class="n">thread_pool</span> <span class="n">pool</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

    <span class="c1">// Define the task to be executed by the thread pool</span>
    <span class="k">auto</span> <span class="n">task</span> <span class="o">=</span> <span class="p">[]()</span> <span class="p">{</span>
        <span class="c1">// Perform some computation or task here</span>
        <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
    <span class="p">};</span>

    <span class="c1">// Start the timer</span>
    <span class="k">auto</span> <span class="n">start</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

    <span class="c1">// Submit the task to the thread pool multiple times</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pool</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">task</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Wait for all tasks to complete</span>
    <span class="n">pool</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span>

    <span class="c1">// Stop the timer</span>
    <span class="k">auto</span> <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

    <span class="c1">// Calculate the elapsed time</span>
    <span class="k">auto</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">).</span><span class="n">count</span><span class="p">();</span>

    <span class="c1">// Print the performance result</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Elapsed time: "</span> <span class="o">&lt;&lt;</span> <span class="n">duration</span> <span class="o">&lt;&lt;</span> <span class="s">" milliseconds"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="c1">// Compare with the performance of executing tasks sequentially</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">task</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">).</span><span class="n">count</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Sequential execution time: "</span> <span class="o">&lt;&lt;</span> <span class="n">duration</span> <span class="o">&lt;&lt;</span> <span class="s">" milliseconds"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="vii-æœªæ¥å±•æœ›">VII. æœªæ¥å±•æœ›</h2>

<p>å°½ç®¡æœ¬ C++ çº¿ç¨‹æ± å®ç°å·²ç»å…·å¤‡äº†è¯¸å¤šå®ç”¨åŠŸèƒ½å’Œè‰¯å¥½æ€§èƒ½ï¼Œä½†ä»æœ‰è¿›ä¸€æ­¥ä¼˜åŒ–å’Œæ‰©å±•çš„ç©ºé—´ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›åç»­è®¡åˆ’å®ç°çš„ç‰¹æ€§ï¼š</p>

<h3 id="è®¡åˆ’å®ç°çš„ç‰¹æ€§">è®¡åˆ’å®ç°çš„ç‰¹æ€§</h3>

<ul>
  <li>
    <p><strong>æ›´å¤šä»»åŠ¡è°ƒåº¦ç­–ç•¥</strong>ï¼šç›®å‰ä»…æ”¯æŒå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰ç­–ç•¥ï¼Œæœªæ¥å°†åŠ å…¥æ›´å¤šè°ƒåº¦ç®—æ³•ï¼Œå¦‚ä¼˜å…ˆçº§è°ƒåº¦ã€å®šæ—¶è°ƒåº¦ç­‰ï¼Œä»¥æ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚</p>
  </li>
  <li>
    <p><strong>æ ¸å¿ƒçº¿ç¨‹æ•°ä¸æœ€å¤§çº¿ç¨‹æ•°æ¦‚å¿µ</strong>ï¼šå¼•å…¥æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°çš„æ¦‚å¿µï¼Œä½¿å¾—çº¿ç¨‹æ± èƒ½åœ¨å·¥ä½œè´Ÿè½½å˜åŒ–æ—¶è‡ªåŠ¨è°ƒæ•´çº¿ç¨‹æ•°é‡ã€‚æ ¸å¿ƒçº¿ç¨‹å§‹ç»ˆä¿ç•™åœ¨æ± ä¸­ï¼Œè€Œæœ€å¤§çº¿ç¨‹æ•°åˆ™é™å®šçº¿ç¨‹æ± å¯åŠ¨æ€æ‰©å±•çš„ä¸Šé™ã€‚</p>
  </li>
  <li>
    <p><strong>ä»»åŠ¡æ‹’ç»ç­–ç•¥</strong>ï¼šé™¤äº†ç°æœ‰çš„é˜Ÿåˆ—æ»¡æ—¶æ‹’ç»æ–°ä»»åŠ¡å¤–ï¼Œå°†å®ç°æ›´ä¸°å¯Œçš„ä»»åŠ¡æ‹’ç»ç­–ç•¥ï¼Œå¹¶å…è®¸ç”¨æˆ·è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ï¼Œä»¥åº”å¯¹ä»»åŠ¡é˜Ÿåˆ—é¥±å’Œçš„ä¸åŒå¤„ç†éœ€æ±‚ã€‚</p>
  </li>
  <li>
    <p><strong>æ·±åº¦æµ‹è¯•ä¸éªŒè¯</strong>ï¼šè¿›è¡Œæ›´å…¨é¢çš„åŠŸèƒ½æµ‹è¯•ã€æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ŒåŒ…æ‹¬ä¸ç°æœ‰çº¿ç¨‹æ± åº“çš„å¯¹æ¯”åˆ†æï¼Œä»¥å……åˆ†å±•ç°æœ¬åº“çš„åŠŸèƒ½ç¨³å®šæ€§å’Œæ€§èƒ½ä¼˜åŠ¿ã€‚</p>
  </li>
</ul>

<hr>

<p>ç»¼ä¸Šæ‰€è¿°ï¼Œå¸Œæœ›è¿™ä¸ªåŸºäºç°ä»£ C++ çš„çº¿ç¨‹æ± å®ç°èƒ½å¤Ÿä¸ºæ›´å¤šC++å¼€å‘è€…çš„å·¥ä½œæä¾›å¸®åŠ©æˆ–å¯å‘ã€‚</p>

<h2 id="é™„å½•-ä¸€äº›å…³é”®å®ç°çš„ä»£ç ">é™„å½•. ä¸€äº›å…³é”®å®ç°çš„ä»£ç </h2>

<h3 id="submit-ä»»åŠ¡æäº¤å‡½æ•°">
<code class="language-plaintext highlighter-rouge">submit()</code> ä»»åŠ¡æäº¤å‡½æ•°</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Submits a task to the thread pool for execution.
 *
 * This function submits a task to the thread pool for execution. The task is a callable object
 * that takes arguments specified by the template parameters. The function returns a std::future
 * object that can be used to retrieve the result of the task once it has completed.
 *
 * @tparam F The type of the callable object.
 * @tparam Args The types of the arguments to the callable object.
 * @param f The callable object to be executed.
 * @param args The arguments to be passed to the callable object.
 * @return A std::future object representing the result of the task.
 * @throws std::runtime_error if the thread pool is in an invalid state or the task queue is full.
 */</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">F</span><span class="p">,</span> <span class="k">typename</span><span class="o">...</span> <span class="nc">Args</span><span class="p">&gt;</span>
<span class="k">auto</span> <span class="n">thread_pool</span><span class="o">::</span><span class="n">submit</span><span class="p">(</span><span class="n">F</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">,</span> <span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">args</span><span class="p">...))</span><span class="o">&gt;</span>
<span class="p">{</span>   <span class="c1">// æäº¤ä»»åŠ¡</span>
    <span class="n">std</span><span class="o">::</span><span class="n">shared_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_mutex</span><span class="o">&gt;</span> <span class="n">status_lock</span><span class="p">(</span><span class="n">status_mutex</span><span class="p">);</span>  <span class="c1">// ä¸ºçŠ¶æ€å˜é‡åŠ å…±äº«é”ï¼Œä»¥ç¡®ä¿çº¿ç¨‹æ± çš„çŠ¶æ€æ˜¯ç¨³å®šçš„</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">status</span><span class="p">.</span><span class="n">load</span><span class="p">())</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">TERMINATED</span><span class="p">:</span> <span class="c1">// çº¿ç¨‹æ± å·²ç»ˆæ­¢</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"[thread_pool::submit][error]: thread pool is terminated"</span><span class="p">);</span>
    <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">TERMINATING</span><span class="p">:</span> <span class="c1">// çº¿ç¨‹æ± å°†ç»ˆæ­¢</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"[thread_pool::submit][error]: thread pool is terminating"</span><span class="p">);</span>
    <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">PAUSED</span><span class="p">:</span> <span class="c1">// çº¿ç¨‹æ± è¢«æš‚åœ</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"[thread_pool::submit][error]: thread pool is paused"</span><span class="p">);</span>
    <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">SHUTDOWN</span><span class="p">:</span> <span class="c1">// çº¿ç¨‹æ± åœ¨ç­‰å¾…ä»»åŠ¡å®Œæˆï¼Œä½†ä¸å†æ¥å—æ–°ä»»åŠ¡</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"[thread_pool::submit][error]: thread pool is waiting for tasks to complete, but not accepting new tasks"</span><span class="p">);</span>
    <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">RUNNING</span><span class="p">:</span> <span class="c1">// çº¿ç¨‹æ± æ­£åœ¨è¿è¡Œ</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="nl">default:</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"[thread_pool::submit][error]: unknown status"</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">max_task_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">get_task_count</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">max_task_count</span><span class="p">)</span>
    <span class="p">{</span>   <span class="c1">// å¦‚æœä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™æ‹’ç»æäº¤ä»»åŠ¡</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"[thread_pool::submit][error]: task queue is full"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">using</span> <span class="n">return_type</span> <span class="o">=</span> <span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">args</span><span class="p">...));</span>
    <span class="k">auto</span> <span class="n">task</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">packaged_task</span><span class="o">&lt;</span><span class="n">return_type</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="p">(</span>
        <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">)...)</span>
    <span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">return_type</span><span class="o">&gt;</span> <span class="n">res</span> <span class="o">=</span> <span class="n">task</span><span class="o">-&gt;</span><span class="n">get_future</span><span class="p">();</span>

    <span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">task_queue_mutex</span><span class="p">);</span>
    <span class="n">task_queue</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="n">task</span><span class="p">](){</span> <span class="p">(</span><span class="o">*</span><span class="n">task</span><span class="p">)();</span> <span class="p">});</span> <span class="c1">// å°†ä»»åŠ¡å°è£…ä¸ºä¸€ä¸ªlambdaè¡¨è¾¾å¼å¹¶æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—   // è¯¥lambdaè¡¨è¾¾å¼ä¼šè°ƒç”¨std::packaged_taskå¯¹è±¡çš„operator()æ–¹æ³•ï¼Œä»è€Œæ‰§è¡Œä»»åŠ¡</span>
    <span class="n">lock</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
    <span class="n">task_queue_cv</span><span class="p">.</span><span class="n">notify_one</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="å·¥ä½œçº¿ç¨‹ä»»åŠ¡å¾ªç¯çš„é€»è¾‘">å·¥ä½œçº¿ç¨‹ä»»åŠ¡å¾ªç¯çš„é€»è¾‘</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">thread_pool</span><span class="o">::</span><span class="n">worker_thread</span><span class="o">::</span><span class="n">worker_thread</span><span class="p">(</span><span class="n">thread_pool</span><span class="o">*</span> <span class="n">pool</span><span class="p">)</span> <span class="o">:</span> 
    <span class="n">pool</span><span class="p">(</span><span class="n">pool</span><span class="p">),</span> 
    <span class="n">status</span><span class="p">(</span><span class="n">status_t</span><span class="o">::</span><span class="n">RUNNING</span><span class="p">),</span> 
    <span class="n">pause_sem</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> 
    <span class="kr">thread</span><span class="p">(</span>
        <span class="p">[</span><span class="k">this</span><span class="p">](){</span>       <span class="c1">// çº¿ç¨‹çš„æ‰§è¡Œé€»è¾‘</span>
            <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span>
            <span class="p">{</span>   
                <span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_mutex</span><span class="o">&gt;</span> <span class="n">unique_lock_status</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">status_mutex</span><span class="p">);</span>
                <span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">unique_lock_status</span><span class="p">.</span><span class="n">owns_lock</span><span class="p">())</span>
                    <span class="p">{</span>
                        <span class="n">unique_lock_status</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
                    <span class="p">}</span>
                    <span class="kt">bool</span> <span class="n">break_flag</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
                    <span class="k">switch</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">.</span><span class="n">load</span><span class="p">())</span>
                    <span class="p">{</span>
                    <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">TERMINATING</span><span class="p">:</span> <span class="c1">// çº¿ç¨‹è¢«è®¾ç½®ä¸ºå°†ç»ˆæ­¢</span>
                        <span class="k">this</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="n">status_t</span><span class="o">::</span><span class="n">TERMINATED</span><span class="p">);</span>
                    <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">TERMINATED</span><span class="p">:</span>  <span class="c1">// çº¿ç¨‹å·²ç»ˆæ­¢</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">RUNNING</span><span class="p">:</span> <span class="c1">// çº¿ç¨‹è¢«è®¾ç½®ä¸ºè¿è¡Œ</span>
                        <span class="n">break_flag</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">PAUSED</span><span class="p">:</span>   <span class="c1">// çº¿ç¨‹è¢«è®¾ç½®ä¸ºæš‚åœ</span>
                        <span class="n">unique_lock_status</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
                        <span class="k">this</span><span class="o">-&gt;</span><span class="n">pause_sem</span><span class="p">.</span><span class="n">acquire</span><span class="p">();</span>  <span class="c1">// é˜»å¡çº¿ç¨‹</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">BLOCKED</span><span class="p">:</span>  <span class="c1">// çº¿ç¨‹è¢«è®¾ç½®ä¸ºç­‰å¾…ä»»åŠ¡</span>
                    <span class="nl">default:</span>    <span class="c1">// æœªçŸ¥çŠ¶æ€</span>
                        <span class="n">unique_lock_status</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
                        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"[thread_pool::worker_thread::worker_thread][error]: undefined status"</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">break_flag</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">unique_lock_status</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="c1">// åœ¨è¿è¡ŒçŠ¶æ€ä¸‹ï¼Œä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªä»»åŠ¡å¹¶æ‰§è¡Œ</span>
                <span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_mutex</span><span class="o">&gt;</span> <span class="n">unique_lock_task_queue</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">pool</span><span class="o">-&gt;</span><span class="n">task_queue_mutex</span><span class="p">);</span>    <span class="c1">// åœ¨å–ä»»åŠ¡å‰ï¼ŒåŠ é”</span>
                <span class="k">while</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">pool</span><span class="o">-&gt;</span><span class="n">task_queue</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
                <span class="p">{</span>   <span class="c1">// å¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™ç­‰å¾…æ¡ä»¶å˜é‡å”¤é†’</span>
                    <span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">unique_lock_status</span><span class="p">.</span><span class="n">owns_lock</span><span class="p">())</span>
                        <span class="p">{</span>
                            <span class="n">unique_lock_status</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
                        <span class="p">}</span>
                        <span class="kt">bool</span> <span class="n">break_flag</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
                        <span class="k">switch</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">.</span><span class="n">load</span><span class="p">())</span>
                        <span class="p">{</span>
                        <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">TERMINATING</span><span class="p">:</span> <span class="c1">// çº¿ç¨‹è¢«è®¾ç½®ä¸ºå°†ç»ˆæ­¢</span>
                            <span class="k">this</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="n">status_t</span><span class="o">::</span><span class="n">TERMINATED</span><span class="p">);</span>
                        <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">TERMINATED</span><span class="p">:</span>  <span class="c1">// çº¿ç¨‹å·²ç»ˆæ­¢</span>
                            <span class="k">return</span><span class="p">;</span>
                        <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">PAUSED</span><span class="p">:</span>  <span class="c1">// çº¿ç¨‹è¢«è®¾ç½®ä¸ºæš‚åœ</span>
                            <span class="n">unique_lock_status</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
                            <span class="n">unique_lock_task_queue</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
                            <span class="k">this</span><span class="o">-&gt;</span><span class="n">pause_sem</span><span class="p">.</span><span class="n">acquire</span><span class="p">();</span>  <span class="c1">// é˜»å¡çº¿ç¨‹</span>
                            <span class="n">unique_lock_task_queue</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">RUNNING</span><span class="p">:</span> <span class="c1">// çº¿ç¨‹è¢«è®¾ç½®ä¸ºè¿è¡Œ</span>
                            <span class="k">this</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="n">status_t</span><span class="o">::</span><span class="n">BLOCKED</span><span class="p">);</span>  <span class="c1">// è®¾ç½®çº¿ç¨‹çŠ¶æ€ä¸ºç­‰å¾…ä»»åŠ¡</span>
                        <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">BLOCKED</span><span class="p">:</span>  <span class="c1">// çº¿ç¨‹è¢«è®¾ç½®ä¸ºç­‰å¾…ä»»åŠ¡</span>
                            <span class="n">break_flag</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="nl">default:</span>    <span class="c1">// æœªçŸ¥çŠ¶æ€</span>
                            <span class="n">unique_lock_status</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
                            <span class="n">unique_lock_task_queue</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
                            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"[thread_pool::worker_thread::worker_thread][error]: unknown status"</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">break_flag</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">unique_lock_status</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">this</span><span class="o">-&gt;</span><span class="n">pool</span><span class="o">-&gt;</span><span class="n">task_queue_cv</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="n">unique_lock_task_queue</span><span class="p">);</span> <span class="c1">// ç­‰å¾…æ¡ä»¶å˜é‡å”¤é†’ï¼›</span>
                    <span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">unique_lock_status</span><span class="p">.</span><span class="n">owns_lock</span><span class="p">())</span>
                        <span class="p">{</span>
                            <span class="n">unique_lock_status</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
                        <span class="p">}</span>
                        <span class="kt">bool</span> <span class="n">break_flag</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
                        <span class="k">switch</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">.</span><span class="n">load</span><span class="p">())</span>
                        <span class="p">{</span>
                        <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">TERMINATING</span><span class="p">:</span> <span class="c1">// çº¿ç¨‹è¢«è®¾ç½®ä¸ºå°†ç»ˆæ­¢</span>
                            <span class="k">this</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="n">status_t</span><span class="o">::</span><span class="n">TERMINATED</span><span class="p">);</span>
                        <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">TERMINATED</span><span class="p">:</span>  <span class="c1">// çº¿ç¨‹å·²ç»ˆæ­¢</span>
                            <span class="k">return</span><span class="p">;</span>
                        <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">PAUSED</span><span class="p">:</span>  <span class="c1">// çº¿ç¨‹è¢«è®¾ç½®ä¸ºæš‚åœ</span>
                            <span class="n">unique_lock_status</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
                            <span class="n">unique_lock_task_queue</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
                            <span class="k">this</span><span class="o">-&gt;</span><span class="n">pause_sem</span><span class="p">.</span><span class="n">acquire</span><span class="p">();</span>  <span class="c1">// é˜»å¡çº¿ç¨‹</span>
                            <span class="n">unique_lock_task_queue</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">BLOCKED</span><span class="p">:</span>  <span class="c1">// çº¿ç¨‹è¢«è®¾ç½®ä¸ºç­‰å¾…ä»»åŠ¡</span>
                            <span class="k">this</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="n">status_t</span><span class="o">::</span><span class="n">RUNNING</span><span class="p">);</span>  <span class="c1">// è®¾ç½®çº¿ç¨‹çŠ¶æ€ä¸ºè¿è¡Œ</span>
                        <span class="k">case</span> <span class="n">status_t</span><span class="o">::</span><span class="n">RUNNING</span><span class="p">:</span> <span class="c1">// çº¿ç¨‹è¢«è®¾ç½®ä¸ºè¿è¡Œ</span>
                            <span class="n">break_flag</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="nl">default:</span>    <span class="c1">// æœªçŸ¥çŠ¶æ€</span>
                            <span class="n">unique_lock_status</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
                            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"[thread_pool::worker_thread::worker_thread][error]: unknown status"</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">break_flag</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">unique_lock_status</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="c1">// å–å‡ºä¸€ä¸ªä»»åŠ¡</span>
                <span class="k">try</span>
                <span class="p">{</span>
                    <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span> <span class="n">task</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">pool</span><span class="o">-&gt;</span><span class="n">task_queue</span><span class="p">.</span><span class="n">front</span><span class="p">());</span>
                    <span class="k">this</span><span class="o">-&gt;</span><span class="n">pool</span><span class="o">-&gt;</span><span class="n">task_queue</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
                    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">pool</span><span class="o">-&gt;</span><span class="n">task_queue</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
                    <span class="p">{</span>   <span class="c1">// å¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™é€šçŸ¥ä»»åŠ¡é˜Ÿåˆ—ç©ºæ¡ä»¶å˜é‡</span>
                        <span class="k">this</span><span class="o">-&gt;</span><span class="n">pool</span><span class="o">-&gt;</span><span class="n">task_queue_empty_cv</span><span class="p">.</span><span class="n">notify_all</span><span class="p">();</span>
                    <span class="p">}</span>
                    <span class="n">unique_lock_task_queue</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>  <span class="c1">// å–å‡ºä»»åŠ¡åï¼Œé‡Šæ”¾é”</span>
                    <span class="n">task</span><span class="p">();</span>     <span class="c1">// æ‰§è¡Œä»»åŠ¡</span>
                <span class="p">}</span>
                <span class="k">catch</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span>
                <span class="p">{</span>   <span class="c1">// å¦‚æœä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™æ‰“å°å¼‚å¸¸ä¿¡æ¯å¹¶ç»§ç»­å¾ªç¯</span>
                    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">)</span> <span class="p">{}</span>
</code></pre></div></div>


    </div>

</article>
<div class="post-nav">
<span></span><span></span>
</div>
<div class="post-related">
      <div>Related Articles</div>
      <ul>
        <li class="top-post">
          <a class="post-link" href="/jekyll-theme-yat/c++/2024/04/24/ThreadPoolBlog.html" title="ä¸€ä¸ªç°ä»£ C++ å®ç°çš„é«˜æ•ˆçº¿ç¨‹æ± ">
            ä¸€ä¸ªç°ä»£ C++ å®ç°çš„é«˜æ•ˆçº¿ç¨‹æ± <span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
</ul>
    </div>
<div class="post-comments"></div></section>
</div>


  </section>
  <section class="sidebar" style="margin-left: 15px;">
    <!-- Get sidebar items --><style type="text/css" media="screen">
.post-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>

<div class="post-menu">
  <div class="post-menu-title">TOC</div>
  <div class="post-menu-content"></div>
</div>

<script>
  function generateContent() {
    var menu = document.querySelector(".post-menu");
    var menuContent =  menu.querySelector(".post-menu-content");
    var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");

    // Hide menu when no headings
    if (headings.length === 0) {
      return menu.style.display = "none";
    }

    // Generate post menu
    var menuHTML = '';
    for (var i = 0; i < headings.length; i++) {
      var h = headings[i];
      menuHTML += (
        '<li class="h-' + h.tagName.toLowerCase() + '">'
        + '<a href="#h-' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
    }

    menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';

    // The header element
    var header = document.querySelector('header.site-header');

    function doMenuCollapse(index, over_items) {
      var items = menuContent.firstChild.children;

      if (over_items == undefined) {
        over_items = 20;
      }

      if (items.length < over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0
        && !items[beginIndex].classList.contains('h-h2')) {
        beginIndex -= 1;
      }
      while (endIndex < items.length
        && !items[endIndex].classList.contains('h-h2')) {
        endIndex += 1;
      }
      for (var i = 0; i < beginIndex; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
      for (var i = beginIndex + 1; i < endIndex; i++) {
        item = items[i]
        // if (!item.classList.contains('h-h2')) {
          item.style.display = '';
        // }
      }
      for (var i = endIndex; i < items.length; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
    }

    // Init menu collapsed
    doMenuCollapse(-1);

    // Active the menu item
    window.addEventListener('scroll', function (event) {
      var lastActive = menuContent.querySelector('.active');
      var changed = true;
      var activeIndex = -1;
      for (var i = headings.length - 1; i >= 0; i--) {
        var h = headings[i];
        var headingRect = h.getBoundingClientRect();
        var headerRect = header.getBoundingClientRect();
        var headerTop = Math.floor(headerRect.top);
        var headerHeight = Math.floor(headerRect.height);
        var headerHeight = headerTop + headerHeight + 20;
        if (headingRect.top <= headerHeight) {
          var id = 'h-' + h.getAttribute('id');
          var a = menuContent.querySelector('a[href="#' + id  + '"]');
          var curActive = a.parentNode;
          if (curActive) {
            curActive.classList.add('active');
            activeIndex = i;
          }
          if (lastActive == curActive) {
            changed = false;
          }
          break;
        }
      }
      if (changed) {
        if (lastActive) {
          lastActive.classList.remove('active');
        }
        doMenuCollapse(activeIndex);
      }
      event.preventDefault();
    });
  }
  generateContent();
</script>
</section>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/jekyll-theme-yat/"></data>

  <div class="wrapper">
    <div class="site-footer-inner">
<div>Copyright <span class="copyleft">Â©</span> 2024 Razirp</div>
      <div>Powered by <a title="Jekyll is a simple, blog-aware, static site
      generator." href="https://jekyllrb.com/">Jekyll</a> &amp; <a title="Yat, yet
      another theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
      <!-- <div class="footer-col rss-subscribe">Subscribe <a href="/jekyll-theme-yat/feed.xml">via RSS</a></div> -->
    </div>
  </div>
</footer>
</body>
</html>
